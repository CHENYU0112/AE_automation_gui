from __future__ import annotations

import logging
import os
import subprocess
import sys

logging.basicConfig(level=logging.INFO)

if __name__ == "__main__":
    try:
        rcc_exe = os.path.abspath(sys.executable + r"\..\pyrcc5.exe")

        for root, _dirs, files in os.walk(os.path.dirname(__file__), topdown=False):
            for name in files:
                path = os.path.join(root, name)
                if os.path.splitext(path)[-1] == ".qrc":
                    try:
                        newpath = os.path.join(root, "resource_rc.py")
                        msg = "Converting file '" + path + "' to '" + newpath + "'"
                        logging.info(msg)
                        print(msg)
                        subprocess.check_output(f"{rcc_exe} {path} -o {newpath}", shell=True)
                    except Exception:
                        logging.error("", exc_info=True)

    except Exception:
        logging.error("", exc_info=True)
