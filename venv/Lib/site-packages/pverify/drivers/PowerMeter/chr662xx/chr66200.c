/*****************************************************************************
 *  Chroma Digital Power Meter 66200 Series Instrument Driver
 *  LabWindows/CVI 6.0 Instrument Driver
 *  Environment: NI IVI Compliance Package 2.1
 *				 CVI Run-Time engine 7.0.0.395
 *				 NI-VISA 3.01
 *  Original Release: 2006/07/03
 *  By: Bill Lu, Chroma
 *      PH. 886-3-3279999 ext:3533   Fax 886-3-3278700
 *
 *  Modification History:
 *
 *       2006/07/03 - Instrument Driver Created.
 *
 *****************************************************************************/

#include <userint.h>
#include <string.h>
#include <stdio.h>
#include <formatio.h>
#include <utility.h>
#include <ansi_c.h>
#include "chr66200.h"

/*****************************************************************************
 *--------------------- Hidden Attribute Declarations -----------------------*
 *****************************************************************************/

#define CHR66200_ATTR_OPC_TIMEOUT      (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 1L)   /* ViInt32 */
#define CHR66200_ATTR_COMPARATOR_ITEM       (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 2L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_V    (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 3L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_VPK_PLUS (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 4L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_VPK_MINUS (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 5L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_THDV (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 6L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_W    (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 7L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_PF   (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 8L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_VA   (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 9L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_VAR  (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 10L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_ENERGY (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 11L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_FREQ (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 12L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_I    (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 13L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_IPK_PLUS (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 14L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_IPK_MINUS (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 15L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_IS   (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 16L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_CF   (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 17L)
#define CHR66200_ATTR_COMPARATOR_LIMIT_THDI (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 18L)

/*****************************************************************************
 *---------------------------- Useful Macros --------------------------------*
 *****************************************************************************/

    /*- I/O buffer size -----------------------------------------------------*/
#define BUFFER_SIZE                             512L
#define CHR66200_IO_SESSION_TYPE   IVI_VAL_VISA_SESSION_TYPE

    /*- 488.2 Event Status Register (ESR) Bits ------------------------------*/
#define IEEE_488_2_QUERY_ERROR_BIT              0x04
#define IEEE_488_2_DEVICE_DEPENDENT_ERROR_BIT   0x08
#define IEEE_488_2_EXECUTION_ERROR_BIT          0x10
#define IEEE_488_2_COMMAND_ERROR_BIT            0x20


    /*- List of channels passed to the Ivi_BuildChannelTable function -------*/
#define CHANNEL_LIST                            "1"

	/*- Internal define value -----------------------------------------------*/
#define	delay_time								0.00
#define	shunt_range_delay_time					1.00
#define Model_66201								"66201"
#define ON_STRING								"ON"
#define OFF_STRING								"OFF"
#define ENERGY_JOULE							"JOULE"
#define ENERGY_WHR								"WHR"
#define Invalid_value							0xBFFA0010
#define Max_Harmonic_Array						101

static IviRangeTableEntry attrWindowRangeTableEntries[] =
	{
		{0.5, 10, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrWindowRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrWindowRangeTableEntries,
	};

static IviRangeTableEntry attrTriggerModeRangeTableEntries[] =
	{
		{CHR66200_VAL_TRIGGER_NONE, 0, 0, "NONE", 0},
		{CHR66200_VAL_TRIGGER_GONG, 0, 0, "GONG", 0},
		{CHR66200_VAL_TRIGGER_INRUSH, 0, 0, "INRUSH", 0},
		{CHR66200_VAL_TRIGGER_ENERGY, 0, 0, "ENERGY", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrTriggerModeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrTriggerModeRangeTableEntries,
	};

static IviRangeTableEntry attrStatusOperationEnableRangeTableEntries[] =
	{
		{0, 255, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrStatusOperationEnableRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrStatusOperationEnableRangeTableEntries,
	};

static IviRangeTableEntry attrStatusQuestionableEnableRangeTableEntries[] =
	{
		{0, 65535, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrStatusQuestionableEnableRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrStatusQuestionableEnableRangeTableEntries,
	};

static IviRangeTableEntry attrStatusQuestionableNtrRangeTableEntries[] =
	{
		{0, 65535, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrStatusQuestionableNtrRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrStatusQuestionableNtrRangeTableEntries,
	};

static IviRangeTableEntry attrStatusQuestionablePtrRangeTableEntries[] =
	{
		{0, 65535, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrStatusQuestionablePtrRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrStatusQuestionablePtrRangeTableEntries,
	};

static IviRangeTableEntry attrStatusSreRangeTableEntries[] =
	{
		{0, 255, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrStatusSreRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrStatusSreRangeTableEntries,
	};

static IviRangeTableEntry attrStatusEseRangeTableEntries[] =
	{
		{0, 255, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrStatusEseRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrStatusEseRangeTableEntries,
	};

static IviRangeTableEntry attrComparatorTimeRangeTableEntries[] =
	{
		{0, 9999, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrComparatorTimeRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrComparatorTimeRangeTableEntries,
	};

static IviRangeTableEntry attrThdOrderRangeTableEntries[] =
	{
		{2, 100, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrThdOrderRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrThdOrderRangeTableEntries,
	};

static IviRangeTableEntry attrEnergyTimeRangeTableEntries[] =
	{
		{0, 9999, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrEnergyTimeRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrEnergyTimeRangeTableEntries,
	};

static IviRangeTableEntry attrPowerIntegrateRangeTableEntries[] =
	{
		{0, 9999, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrPowerIntegrateRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrPowerIntegrateRangeTableEntries,
	};

static IviRangeTableEntry attrAverageRangeTableEntries[] =
	{
		{1, 512, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrAverageRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrAverageRangeTableEntries,
	};

static IviRangeTableEntry attrVoltRangeRangeTableEntries[] =
	{
		{CHR66200_VAL_VOLT_RANGE_V150, 0, 0, "V150", 0},
		{CHR66200_VAL_VOLT_RANGE_V300, 0, 0, "V300", 0},
		{CHR66200_VAL_VOLT_RANGE_V500, 0, 0, "V500", 0},
		{CHR66200_VAL_VOLT_RANGE_AUTO, 0, 0, "AUTO", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrVoltRangeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrVoltRangeRangeTableEntries,
	};

static IviRangeTableEntry attrInrushDelayRangeTableEntries[] =
	{
		{0, 9999, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrInrushDelayRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrInrushDelayRangeTableEntries,
	};

static IviRangeTableEntry attrInrushTimeRangeTableEntries[] =
	{
		{1, 9999, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrInrushTimeRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrInrushTimeRangeTableEntries,
	};

static IviRangeTableEntry attrInrushLevelRangeTableEntries[] =
	{
		{1, 10, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrInrushLevelRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrInrushLevelRangeTableEntries,
	};

static IviRangeTableEntry attrCurrRangeRangeTableEntries[] =
	{
		{CHR66200_VAL_CURR_RANGE_A001, 0, 0, "A001", 0},
		{CHR66200_VAL_CURR_RANGE_A01, 0, 0, "A01", 0},
		{CHR66200_VAL_CURR_RANGE_A04, 0, 0, "A04", 0},
		{CHR66200_VAL_CURR_RANGE_A2L, 0, 0, "A2L", 0},
		{CHR66200_VAL_CURR_RANGE_A02, 0, 0, "A02", 0},
		{CHR66200_VAL_CURR_RANGE_A2H, 0, 0, "A2H", 0},
		{CHR66200_VAL_CURR_RANGE_A8, 0, 0, "A8", 0},
		{CHR66200_VAL_CURR_RANGE_A20, 0, 0, "A20", 0},
		{CHR66200_VAL_CURR_RANGE_AUTO, 0, 0, "AUTO", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrCurrRangeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrCurrRangeRangeTableEntries,
	};

static IviRangeTableEntry attrCurrShuntRangeTableEntries[] =
	{
		{CHR66200_VAL_SHUNT_LOW, 0, 0, "LOW", 0},
		{CHR66200_VAL_SHUNT_HIGH, 0, 0, "HIGH", 0},
		{CHR66200_VAL_SHUNT_AUTO, 0, 0, "AUTO", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrCurrShuntRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrCurrShuntRangeTableEntries,
	};

static IviRangeTableEntry attrPowerTypeRangeTableEntries[] =
	{
		{CHR66200_VAL_MEAS_PWR_REAL, 0, 0, "W", 0},
		{CHR66200_VAL_MEAS_PWR_APP, 0, 0, "VA", 0},
		{CHR66200_VAL_MEAS_PWR_REAC, 0, 0, "VAR", 0},
		{CHR66200_VAL_MEAS_PWR_FACTOR, 0, 0, "PF", 0},
		{CHR66200_VAL_MEAS_PWR_ENERGY, 0, 0, "ENEG", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrPowerTypeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrPowerTypeRangeTableEntries,
	};

static IviRangeTableEntry attrCurrTypeRangeTableEntries[] =
	{
		{CHR66200_VAL_MEAS_IRMS, 0, 0, "I", 0},
		{CHR66200_VAL_MEAS_IPEAK_PLUS, 0, 0, "IPK+", 0},
		{CHR66200_VAL_MEAS_IPEAK_MINUS, 0, 0, "IPK-", 0},
		{CHR66200_VAL_MEAS_INRUSH, 0, 0, "IS", 0},
		{CHR66200_VAL_MEAS_CREST, 0, 0, "CFI", 0},
		{CHR66200_VAL_MEAS_ITHD, 0, 0, "THDI", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrCurrTypeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrCurrTypeRangeTableEntries,
	};

static IviRangeTableEntry attrVoltTypeRangeTableEntries[] =
	{
		{CHR66200_VAL_MEAS_VRMS, 0, 0, "V", 0},
		{CHR66200_VAL_MEAS_VPEAK_PLUS, 0, 0, "VPK+", 0},
		{CHR66200_VAL_MEAS_VPEAK_MINUS, 0, 0, "VPK-", 0},
		{CHR66200_VAL_MEAS_VTHD, 0, 0, "THDV", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrVoltTypeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrVoltTypeRangeTableEntries,
	};

/*****************************************************************************
 *-------------- Utility Function Declarations (Non-Exported) ---------------*
 *****************************************************************************/
static ViStatus chr66200_InitAttributes (ViSession vi);
static ViStatus chr66200_DefaultInstrSetup (ViSession openInstrSession);
static ViStatus chr66200_CheckStatus (ViSession vi);
static ViStatus chr66200_WaitForOPC (ViSession vi, ViInt32 maxTime);

ViStatus _VI_FUNC chr66200_command_not_support (ViSession vi, ViString not_support_model, ViInt32 cmdindex, ViInt32 not_support_cmdindex, ViStatus error_meaasge);
ViStatus _VI_FUNC chr66200_function_skip (ViSession vi, ViString not_support_model);
ViStatus _VI_FUNC chr66200_running_error (ViSession vi, ViInt32 mode);
ViStatus _VI_FUNC chr66200_trigger_error (ViSession vi, ViBoolean trigger_on_off);
//void _VI_FUNC CreateIviIniIfNeeded(void);



    /*- File I/O Utility Functions -*/
static ViStatus chr66200_ReadToFile (ViSession vi, ViConstString filename,
                                     ViInt32 maxBytesToRead, ViInt32 fileAction, ViInt32 *totalBytesWritten);
static ViStatus chr66200_WriteFromFile (ViSession vi, ViConstString filename,
                                        ViInt32 maxBytesToWrite, ViInt32 byteOffset,
                                        ViInt32 *totalBytesWritten);

/*****************************************************************************
 *----------------- Callback Declarations (Non-Exported) --------------------*
 *****************************************************************************/

    /*- Global Session Callbacks --------------------------------------------*/

static ViStatus _VI_FUNC chr66200_CheckStatusCallback (ViSession vi, ViSession io);
static ViStatus _VI_FUNC chr66200_WaitForOPCCallback (ViSession vi, ViSession io);

    /*- Attribute callbacks -------------------------------------------------*/

static ViStatus _VI_FUNC chr66200AttrDriverRevision_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  const ViConstString cacheValue);
static ViStatus _VI_FUNC chr66200AttrInstrumentManufacturer_ReadCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          const ViConstString cacheValue);
static ViStatus _VI_FUNC chr66200AttrInstrumentModel_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue);

static ViStatus _VI_FUNC chr66200AttrFirmwareRevision_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    const ViConstString cacheValue);
static ViStatus _VI_FUNC chr66200AttrIdQueryResponse_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue);

static ViStatus _VI_FUNC chr66200AttrCurrShunt_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrCurrShunt_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrCurrRange_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrCurrRange_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrInrushLevel_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrInrushLevel_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrInrushTime_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrInrushTime_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrInrushDelay_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrInrushDelay_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrVoltRange_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrVoltRange_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrAverage_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrAverage_WriteCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrPowerIntegrate_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrPowerIntegrate_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrFilter_ReadCallback (ViSession vi,
                                                          ViSession io,
                                                          ViConstString channelName,
                                                          ViAttr attributeId,
                                                          ViBoolean *value);

static ViStatus _VI_FUNC chr66200AttrFilter_WriteCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViBoolean value);

static ViStatus _VI_FUNC chr66200AttrEnergyTime_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrEnergyTime_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrThdMode_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViBoolean *value);

static ViStatus _VI_FUNC chr66200AttrThdMode_WriteCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViBoolean value);

static ViStatus _VI_FUNC chr66200AttrThdOrder_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrThdOrder_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrComparator_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViBoolean *value);

static ViStatus _VI_FUNC chr66200AttrComparator_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViBoolean value);

static ViStatus _VI_FUNC chr66200AttrComparatorTime_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrComparatorTime_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrComparatorItem_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  const ViConstString cacheValue);

static ViStatus _VI_FUNC chr66200AttrComparatorItem_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitV_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitVpkPlus_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitVpkMinus_WriteCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitThdv_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitW_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitPf_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitVa_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitVar_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitEnergy_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitFreq_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitI_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitIpkPlus_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitIpkMinus_WriteCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitIs_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitCf_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value);

static ViStatus _VI_FUNC chr66200AttrComparatorLimitThdi_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViConstString value);

static ViStatus _VI_FUNC chr66200AttrStatusEse_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrStatusEse_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrStatusSre_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrStatusSre_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrStatusOperationEnable_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrStatusOperationEnable_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrStatusQuestionableEnable_ReadCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrStatusQuestionableEnable_WriteCallback (ViSession vi,
                                                                             ViSession io,
                                                                             ViConstString channelName,
                                                                             ViAttr attributeId,
                                                                             ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrStatusQuestionableNtr_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrStatusQuestionableNtr_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrStatusQuestionablePtr_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrStatusQuestionablePtr_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrEnergyMode_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViBoolean *value);

static ViStatus _VI_FUNC chr66200AttrEnergyMode_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViBoolean value);

static ViStatus _VI_FUNC chr66200AttrTriggerMode_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC chr66200AttrTriggerMode_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC chr66200AttrMeasMode_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViBoolean *value);

static ViStatus _VI_FUNC chr66200AttrMeasMode_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViBoolean value);

static ViStatus _VI_FUNC chr66200AttrWindow_ReadCallback (ViSession vi,
                                                          ViSession io,
                                                          ViConstString channelName,
                                                          ViAttr attributeId,
                                                          ViReal64 *value);

static ViStatus _VI_FUNC chr66200AttrWindow_WriteCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViReal64 value);


/*****************************************************************************
 *------------ Instrument-specific public Functions (Non-Exported Functions) ---------------*
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_command_not_support (ViSession vi, ViString not_support_model, ViInt32 cmdindex, ViInt32 not_support_cmdindex, ViStatus error_meaasge)
{
	ViStatus	error = VI_SUCCESS;
	ViChar      modelQ[BUFFER_SIZE]="";

	checkErr( Ivi_GetAttributeViString (vi, "", CHR66200_ATTR_INSTRUMENT_MODEL,
                                        0, BUFFER_SIZE, modelQ));

	if ( (strncmp(modelQ,not_support_model,5) == 0) && (cmdindex == not_support_cmdindex) )
		checkErr( error=error_meaasge );

Error:
	return error;
}

ViStatus _VI_FUNC chr66200_function_skip (ViSession vi, ViString not_support_model)
{
	ViStatus	error = VI_SUCCESS;
	ViChar      modelQ[BUFFER_SIZE]="";

	checkErr( Ivi_GetAttributeViString (vi, "", CHR66200_ATTR_INSTRUMENT_MODEL,
                                        0, BUFFER_SIZE, modelQ));

	if ( strncmp(modelQ,not_support_model,5) == 0 )
		error=1;

Error:
	return error;
}

ViStatus _VI_FUNC chr66200_running_error (ViSession vi, ViInt32 mode)
{
	ViStatus	error = VI_SUCCESS;
	ViInt32		TrigMode=0;
	ViChar      TrigState[BUFFER_SIZE]="";

	checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_TRIGGER_MODE, 0, &TrigMode));

	checkErr( chr66200_QueryTriggerState (vi, TrigState));

	if ( (stricmp(TrigState,"RUNNING") == 0) )
	{
		if ( (TrigMode==mode) && (TrigMode==1) )
			checkErr( error= CHR66200_ERROR_STATE_GONG );
		else if ( (TrigMode==mode) && (TrigMode==2) )
			checkErr( error= CHR66200_ERROR_STATE_IS );
		else if ( (TrigMode==mode) && (TrigMode==3) )
			checkErr( error= CHR66200_ERROR_STATE_ENERGY );
	}

Error:
	return error;
}

ViStatus _VI_FUNC chr66200_trigger_error (ViSession vi, ViBoolean trigger_on_off)
{
	ViStatus	error = VI_SUCCESS;
	ViInt32		TrigMode=0;
	ViChar      TrigState[BUFFER_SIZE]="";

	checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_TRIGGER_MODE, 0, &TrigMode));

	checkErr( chr66200_QueryTriggerState (vi, TrigState));

	if ( trigger_on_off == VI_TRUE )
	{
		if ( (TrigMode==0) || (stricmp(TrigState,"RUNNING") == 0) )
			checkErr( error= CHR66200_ERROR_TRIG_ON );
	}
	else
	{
		if ( (stricmp(TrigState,"RUNNING") != 0) )
			checkErr( error= CHR66200_ERROR_TRIG_OFF );
	}

Error:
	return error;
}

/*****************************************************************************
 *------------ User-Callable Functions (Exportable Functions) ---------------*
 *****************************************************************************/

/*****************************************************************************
 * Function: chr66200_init
 * Purpose:  VXIplug&play required function.  Calls the
 *           chr66200_InitWithOptions function.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_init (ViRsrc resourceName, ViBoolean IDQuery,
                                 ViBoolean resetDevice, ViSession *newVi)
{
    ViStatus    error = VI_SUCCESS;

    if (newVi == VI_NULL)
        {
        Ivi_SetErrorInfo (VI_NULL, VI_FALSE, IVI_ERROR_INVALID_PARAMETER,
                          VI_ERROR_PARAMETER4, "Null address for Instrument Handle");
        checkErr( IVI_ERROR_INVALID_PARAMETER);
        }

    checkErr( chr66200_InitWithOptions (resourceName, IDQuery, resetDevice,
                                        "", newVi));

Error:
    return error;
}

/*****************************************************************************
 * Function: chr66200_InitWithOptions
 * Purpose:  This function creates a new IVI session and calls the
 *           IviInit function.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_InitWithOptions (ViRsrc resourceName, ViBoolean IDQuery,
                                            ViBoolean resetDevice, ViString optionString,
                                            ViSession *newVi)
{
    ViStatus    error = VI_SUCCESS;
    ViSession   vi = VI_NULL;
    ViChar      newResourceName[IVI_MAX_MESSAGE_BUF_SIZE];
    ViChar      newOptionString[IVI_MAX_MESSAGE_BUF_SIZE];
    ViBoolean   isLogicalName;

    if (newVi == VI_NULL)
        {
        Ivi_SetErrorInfo (VI_NULL, VI_FALSE, IVI_ERROR_INVALID_PARAMETER,
                          VI_ERROR_PARAMETER5, "Null address for Instrument Handle");
        checkErr( IVI_ERROR_INVALID_PARAMETER);
        }

    *newVi = VI_NULL;

    //CreateIviIniIfNeeded();
    checkErr( Ivi_GetInfoFromResourceName (resourceName, optionString, newResourceName,
                                           newOptionString, &isLogicalName));

        /* create a new interchangeable driver */
    checkErr( Ivi_SpecificDriverNew ("chr66200", newOptionString, &vi));

        /* init the driver */
    checkErr( chr66200_IviInit (newResourceName, IDQuery, resetDevice, vi));
    if (isLogicalName)
        checkErr( Ivi_ApplyDefaultSetup (vi));
    *newVi = vi;

Error:
    if (error < VI_SUCCESS)
        Ivi_Dispose (vi);

    return error;
}

// create ivi.ini when ivi.ini is not exist. (IVI run time engine 1.83 will miss this file)
/*void _VI_FUNC CreateIviIniIfNeeded(void)
{
	FILE *fIviIni = NULL;
	int iTmp;
	char sTmp[IVI_MAX_PATHNAME_LEN];

	if ( Ivi_GetIviIniDir(sTmp)==0 ) // Notice: if IVI engine is greater than 1.83, user can remark this function to prevent CVI debug run-time error, Bill
	{
	if (SetDir (sTmp)!=0)
		MakeDir(sTmp);
	if(sTmp[strlen(sTmp)-1] == '\\') sTmp[strlen(sTmp)-1]=0;
	strcat(sTmp, "\\ivi.ini");
//	MessagePopup("Before checking", sTmp);
	if(GetFileDate(sTmp, &iTmp, &iTmp, &iTmp) != -1)
		return;
	fIviIni = fopen (sTmp, "a");
//	if(fIviIni==NULL)
//		MessagePopup("File Open Error", sTmp);
	if(fIviIni != NULL)
		fclose(fIviIni);
	}
}*/

/*****************************************************************************
 * Function: chr66200_IviInit
 * Purpose:  This function is called by chr66200_InitWithOptions
 *           or by an IVI class driver.  This function initializes the I/O
 *           interface, optionally resets the device, optionally performs an
 *           ID query, and sends a default setup to the instrument.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_IviInit (ViRsrc resourceName, ViBoolean IDQuery,
                                    ViBoolean reset, ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    ViSession   io = VI_NULL;

    checkErr( Ivi_BuildChannelTable (vi, CHANNEL_LIST, VI_FALSE, VI_NULL));

     /* Add attributes */
    checkErr( chr66200_InitAttributes (vi));

    if (!Ivi_Simulating(vi))
        {
        ViSession   rmSession = VI_NULL;

        /* Open instrument session */
        checkErr( Ivi_GetAttributeViSession (vi, VI_NULL, IVI_ATTR_VISA_RM_SESSION, 0,
                                             &rmSession));
        viCheckErr( viOpen (rmSession, resourceName, VI_NULL, VI_NULL, &io));
        /* io session owned by driver now */
        checkErr( Ivi_SetAttributeViSession (vi, VI_NULL, IVI_ATTR_IO_SESSION, 0, io));

		/* Configure VISA Formatted I/O */
		viCheckErr( viSetAttribute (io, VI_ATTR_TMO_VALUE, 5000 ));
		viCheckErr( viSetBuf (io, VI_READ_BUF | VI_WRITE_BUF, 4000));
		viCheckErr( viSetAttribute (io, VI_ATTR_WR_BUF_OPER_MODE, VI_FLUSH_ON_ACCESS));
		viCheckErr( viSetAttribute (io, VI_ATTR_RD_BUF_OPER_MODE, VI_FLUSH_ON_ACCESS));
        }

		checkErr( Ivi_SetAttributeViBoolean (vi, VI_NULL, IVI_ATTR_QUERY_INSTR_STATUS,
	    	                                 0, VI_TRUE));

    /*- Reset instrument ----------------------------------------------------*/
    if (reset)
        checkErr( chr66200_reset (vi));
    else  /*- Send Default Instrument Setup ---------------------------------*/
        checkErr( chr66200_DefaultInstrSetup (vi));

	/*- Identification Query ------------------------------------------------*/
	if (IDQuery)
	    {
	    ViChar rdBuffer[BUFFER_SIZE];

	    #define VALID_RESPONSE_STRING_START        "Chroma ATE,662"

	    checkErr( Ivi_GetAttributeViString (vi, VI_NULL, CHR66200_ATTR_ID_QUERY_RESPONSE,
	                                        0, BUFFER_SIZE, rdBuffer));

	    if (strncmp (rdBuffer, VALID_RESPONSE_STRING_START,
	                 strlen(VALID_RESPONSE_STRING_START)) != 0)
	        {
	        viCheckErr( VI_ERROR_FAIL_ID_QUERY);
	        }
	    }

    checkErr( chr66200_CheckStatus (vi));

Error:
    if (error < VI_SUCCESS)
        {
        if (!Ivi_Simulating (vi) && io)
            viClose (io);
        }
    return error;
}

/*****************************************************************************
 * Function: chr66200_close
 * Purpose:  This function closes the instrument.
 *
 *           Note:  This function must unlock the session before calling
 *           Ivi_Dispose.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_close (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    checkErr( chr66200_IviClose (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    Ivi_Dispose (vi);

    return error;
}

/*****************************************************************************
 * Function: chr66200_IviClose
 * Purpose:  This function performs all of the drivers clean-up operations
 *           except for closing the IVI session.  This function is called by
 *           chr66200_close or by an IVI class driver.
 *
 *           Note:  This function must close the I/O session and set
 *           IVI_ATTR_IO_SESSION to 0.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_IviClose (ViSession vi)
{
    ViStatus error = VI_SUCCESS;
    ViSession io = VI_NULL;

        /* Do not lock here.  The caller manages the lock. */

    checkErr( Ivi_GetAttributeViSession (vi, VI_NULL, IVI_ATTR_IO_SESSION, 0, &io));

Error:
    Ivi_SetAttributeViSession (vi, VI_NULL, IVI_ATTR_IO_SESSION, 0, VI_NULL);
    if(io)
        {
        viClose (io);
        }
    return error;
}

/*****************************************************************************
 * Function: chr66200_WaveCap
 * Purpose:  This function is used to acquire a new waveform
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_WaveCap (ViSession vi)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		rdBuffer[BUFFER_SIZE];

	checkErr( Ivi_LockSession (vi, VI_NULL));
	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_CMD_NOT_SUPPORT));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "WAV:CAP?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%s", rdBuffer));
		Delay (delay_time);
		if( stricmp(rdBuffer,"OK") != 0 )
			checkErr( error= CHR66200_ERROR_WAVCAP_FAIL );
	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_GetWave
 * Purpose:  This function is used to get voltage or current waveform data
 *			 from the power meter after acquire a new waveform
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_GetWave (ViSession vi,
                                    ViBoolean waveform, float returnedData[],
                                    ViInt32 *returnedCount)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		rdBuffer[40000],tmp1[20]="";
	ViInt32		i=0,length=0;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_CMD_NOT_SUPPORT));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		if (waveform == VI_TRUE)
			viCheckErr( viPrintf (io, "WAV:DATA? V\n"));
		else
			viCheckErr( viPrintf (io, "WAV:DATA? I\n"));
		Delay (delay_time);
		viCheckErr( viRead (io, rdBuffer, 40000, returnedCount));
		Delay (delay_time);
		if ( strncmp(rdBuffer, "#", 1) != 0 )
			checkErr( error= CHR66200_ERROR_WAVEFORM_READ );
		else
		{
			i=1;
			while ( (strncmp( (rdBuffer+i) , "0", 1) == 0) && (i<10) )
			{
				i++;
			}
			if ( i==10 )
				checkErr( error= CHR66200_ERROR_WAVEFORM_READ );
			else
			{
				strncpy (tmp1, (rdBuffer+i+1), (rdBuffer[i]-48));
				tmp1[rdBuffer[i]-48]=VI_NULL;
				length=atoi (tmp1);
				memcpy (returnedData, (rdBuffer+i+1+(rdBuffer[i]-48)), length);
				*returnedCount=length/4;
			}
		}
	}

	else
		*returnedCount=2048;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_MeasureAll
 * Purpose:  This function returns measurement data from the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_MeasureAll (ViSession vi,
                                       ViBoolean measureFetch,
                                       ViChar returnedData[])
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (returnedData == VI_NULL)
    	viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Returned Data");

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		if (measureFetch == VI_TRUE)
			viCheckErr( viPrintf (io, "MEAS?\n"));
		else
			viCheckErr( viPrintf (io, "FETC?\n"));

		Delay (delay_time);
		viCheckErr( viScanf (io, "%s", returnedData));
		Delay (delay_time);
	}
	else
		Fmt (returnedData, "0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_MeasureVoltage
 * Purpose:  This function returns the measured voltage of RMS, PEAK+, PEAK-
 *           or total harmonic distortion.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_MeasureVoltage (ViSession vi,
                                           ViBoolean measureFetch, ViInt32 type,
                                           ViReal64 *readValue)
{
	ViStatus	error = VI_SUCCESS;
	ViString	Cmd;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (readValue == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for ReadValue" );

	checkErr( chr66200_command_not_support (vi, Model_66201, type, 3, CHR66200_ERROR_THD));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		checkErr( Ivi_GetViInt32EntryFromIndex (type, &attrVoltTypeRangeTable, VI_NULL, VI_NULL,
												VI_NULL, &Cmd, VI_NULL));
		if (measureFetch == VI_TRUE)
			viCheckErr( viPrintf (io, "MEAS? %s\n", Cmd));
		else
			viCheckErr( viPrintf (io, "FETC? %s\n", Cmd));

		Delay (delay_time);
		viCheckErr( viScanf (io, "%Lf", readValue));
		Delay (delay_time);
	}
	else
		*readValue=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_MeasureCurrent
 * Purpose:  This function returns the measured current of RMS, PEAK+, PEAK-,
 *           INRUSH, CRESTFACTOR or total harmonic distortion.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_MeasureCurrent (ViSession vi,
                                           ViBoolean measureFetch, ViInt32 type,
                                           ViReal64 *readValue)
{
	ViStatus	error = VI_SUCCESS;
	ViString	Cmd;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (readValue == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for ReadValue" );

	checkErr( chr66200_command_not_support (vi, Model_66201, type, 3, CHR66200_ERROR_IS));
	checkErr( chr66200_command_not_support (vi, Model_66201, type, 5, CHR66200_ERROR_THD));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		checkErr( Ivi_GetViInt32EntryFromIndex (type, &attrCurrTypeRangeTable, VI_NULL, VI_NULL,
												VI_NULL, &Cmd, VI_NULL));
		if (measureFetch == VI_TRUE)
			viCheckErr( viPrintf (io, "MEAS? %s\n", Cmd));
		else
			viCheckErr( viPrintf (io, "FETC? %s\n", Cmd));

		Delay (delay_time);
		viCheckErr( viScanf (io, "%Lf", readValue));
		Delay (delay_time);
	}
	else
		*readValue=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_MeasurePower
 * Purpose:  This function returns the measured true power, apparent power,
 *           reactive power, power factor or energy.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_MeasurePower (ViSession vi,
                                         ViBoolean measureFetch, ViInt32 type,
                                         ViReal64 *readValue)
{
	ViStatus	error = VI_SUCCESS;
	ViString	Cmd;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (readValue == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for ReadValue" );

	checkErr( chr66200_command_not_support (vi, Model_66201, type, 4, CHR66200_ERROR_ENERGY));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		checkErr( Ivi_GetViInt32EntryFromIndex (type, &attrPowerTypeRangeTable, VI_NULL, VI_NULL,
												VI_NULL, &Cmd, VI_NULL));
		if (measureFetch == VI_TRUE)
			viCheckErr( viPrintf (io, "MEAS? %s\n", Cmd));
		else
			viCheckErr( viPrintf (io, "FETC? %s\n", Cmd));

		Delay (delay_time);
		viCheckErr( viScanf (io, "%Lf", readValue));
		Delay (delay_time);
	}
	else
		*readValue=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_MeasureFreq
 * Purpose:  This function returns the measured frequency.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_MeasureFreq (ViSession vi,
                                        ViBoolean measureFetch,
                                        ViReal64 *readValue)
{
	ViStatus	error = VI_SUCCESS;
	ViString	Cmd="FREQ";

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (readValue == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for ReadValue" );

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);

		if (measureFetch == VI_TRUE)
			viCheckErr( viPrintf (io, "MEAS? %s\n", Cmd));
		else
			viCheckErr( viPrintf (io, "FETC? %s\n", Cmd));

		Delay (delay_time);
		viCheckErr( viScanf (io, "%Lf", readValue));
		Delay (delay_time);
	}
	else
		*readValue=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_MeasureVoltHarm
 * Purpose:  This function returns the measured harmonic of voltage.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_MeasureVoltHarm (ViSession vi,
                                            ViBoolean measureFetch,
                                            ViBoolean type,
                                            ViChar returnedData[])
{
	ViStatus	error = VI_SUCCESS;
	ViChar      wrBuffer[BUFFER_SIZE]="";
	ViChar      wrBuffer1[BUFFER_SIZE]="";
	ViInt32		i=0;
	ViInt64		length=0;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_CMD_NOT_SUPPORT));
	if (returnedData == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for Returned Data" );

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);

		if (measureFetch == VI_TRUE)
			sprintf( wrBuffer,"MEAS:VOLT:HARM:ARRAY?");
		else
			sprintf( wrBuffer,"FETC:VOLT:HARM:ARRAY?");

		if (type == VI_TRUE)
			sprintf( wrBuffer1,"%s VALUE",wrBuffer);
		else
			sprintf( wrBuffer1,"%s PERCENT",wrBuffer);

		viCheckErr( viPrintf (io, "%s\n", wrBuffer1));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%s", returnedData));
		Delay (delay_time);
	}
	else
	{
		for (i=0;i<Max_Harmonic_Array;i++)
			strcat (returnedData, "0,");
		length=strlen (returnedData);
		returnedData[length-1]=0;
		length=strlen (returnedData);
	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_MeasureCurrHarm
 * Purpose:  This function returns the measured harmonic of current.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_MeasureCurrHarm (ViSession vi,
                                            ViBoolean measureFetch,
                                            ViBoolean type,
                                            ViChar returnedData[])
{
	ViStatus	error = VI_SUCCESS;
	ViChar      wrBuffer[BUFFER_SIZE]="";
	ViChar      wrBuffer1[BUFFER_SIZE]="";
	ViInt32		i=0;
	ViInt64		length=0;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_CMD_NOT_SUPPORT));
	if (returnedData == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for Returned Data" );

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);

		if (measureFetch == VI_TRUE)
			sprintf( wrBuffer,"MEAS:CURR:HARM:ARRAY?");
		else
			sprintf( wrBuffer,"FETC:CURR:HARM:ARRAY?");

		if (type == VI_TRUE)
			sprintf( wrBuffer1,"%s VALUE",wrBuffer);
		else
			sprintf( wrBuffer1,"%s PERCENT",wrBuffer);

		viCheckErr( viPrintf (io, "%s\n", wrBuffer1));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%s", returnedData));
		Delay (delay_time);
	}
	else
	{
		for (i=0;i<Max_Harmonic_Array;i++)
			strcat (returnedData, "0,");
		length=strlen (returnedData);
		returnedData[length-1]=0;
		length=strlen (returnedData);
	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetCurrentShunt
 * Purpose:  This function sets the current shunt range to the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetCurrentShunt (ViSession vi,
                                            ViInt32 shuntRange)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_CMD_NOT_SUPPORT));

	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_CURR_SHUNT, IVI_VAL_DIRECT_USER_CALL,
											shuntRange), 2, "Shunt Range");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetCurrentRange
 * Purpose:  This function sets the current range to the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetCurrentRange (ViSession vi,
                                            ViInt32 currentRange)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	checkErr( chr66200_command_not_support (vi, Model_66201, currentRange, 4, CHR66200_ERROR_CMD_NOT_SUPPORT));
	checkErr( chr66200_command_not_support (vi, Model_66201, currentRange, 5, CHR66200_ERROR_CMD_NOT_SUPPORT));
	checkErr( chr66200_command_not_support (vi, Model_66201, currentRange, 6, CHR66200_ERROR_CMD_NOT_SUPPORT));
	checkErr( chr66200_command_not_support (vi, Model_66201, currentRange, 7, CHR66200_ERROR_CMD_NOT_SUPPORT));
	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_CURR_RANGE, IVI_VAL_DIRECT_USER_CALL,
											currentRange), 2, "Current Range");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetInrush
 * Purpose:  This function sets the inrush trigger level, time and delay to
 *           the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetInrush (ViSession vi, ViInt32 level,
                                      ViInt32 time, ViInt32 delay)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_IS));
	checkErr( chr66200_running_error (vi, 2));
	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_INRUSH_LEVEL, 0,
											level), 2, "Level");
	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_INRUSH_TIME, 0,
											time), 3, "Time");
	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_INRUSH_DELAY, 0,
											delay), 4, "Delay");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetVoltageRange
 * Purpose:  This function sets the voltage range to the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetVoltageRange (ViSession vi,
                                            ViInt32 voltageRange)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_VOLT_RANGE, 0,
											voltageRange), 2, "Voltage Range");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetPowerIntegrate
 * Purpose:  This function sets the power integrate time to the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetPowerIntegrate (ViSession vi,
                                              ViInt32 powerIntegrate)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_POWER_INTEGRATE, 0,
											powerIntegrate), 2, "Power Integrate");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetFilter
 * Purpose:  This function is used to switch the low pass filter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetFilter (ViSession vi,
                                      ViBoolean filter)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, CHR66200_ATTR_FILTER, 0,
											filter), 2, "Filter");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetMeasMode
 * Purpose:  This function sets the measure mode, window time and average to
 *			 the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetMeasMode (ViSession vi,
                                        ViBoolean measureMode, ViReal64 windowTime,
                                        ViInt32 average)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, CHR66200_ATTR_MEAS_MODE, 0,
											measureMode), 2, "Measure Mode");
	if ( measureMode == VI_TRUE)
		viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, CHR66200_ATTR_WINDOW, IVI_VAL_DIRECT_USER_CALL,
												windowTime), 3, "Window Time");
	else
		viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_AVERAGE, 0,
												average), 4, "Average");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetEnergy
 * Purpose:  This function sets the energy mode and energy time to the power
 *           meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetEnergy (ViSession vi, ViBoolean Mode,
                                      	ViInt32 Time)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_ENERGY));
	checkErr( chr66200_running_error (vi, 3));
	viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, CHR66200_ATTR_ENERGY_MODE, 0,
											Mode), 2, "Mode");
	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_ENERGY_TIME, 0,
											Time), 3, "Time");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetTHD
 * Purpose:  This function sets the THD mode and order to the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetTHD (ViSession vi, ViBoolean THDMode,
                                   ViInt32 order)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_THD));
	viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, CHR66200_ATTR_THD_MODE, 0,
											THDMode), 2, "THD Mode");
	if (THDMode == VI_FALSE)
		viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_THD_ORDER, 0,
												order), 3, "Order");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_ClearProtection
 * Purpose:  This function clears the protection message.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_ClearProtection (ViSession vi)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "PROT:CLEAR\n"));
		Delay (delay_time);
	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_AutoCalib
 * Purpose:  This function is used to force 662xx to re-calibrate the offset
 *           of current
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_AutoCalib (ViSession vi)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		rdBuffer[BUFFER_SIZE];

	checkErr( Ivi_LockSession (vi, VI_NULL));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "CALIBRATION:AUTO?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%s", rdBuffer));
		Delay (delay_time);
		if( stricmp(rdBuffer,"OK") != 0 )
			checkErr( error= CHR66200_ERROR_CALIB_FAIL );
	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetTrigger
 * Purpose:  Three different modes, GONG, INRUSH and ENERGY are triggered by
 *           this function.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetTrigger (ViSession vi,
                                       ViBoolean trigger)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		checkErr( chr66200_trigger_error (vi, trigger));
		checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
		if ( trigger == VI_TRUE)
			viCheckErr( viPrintf (io, "TRIG ON\n"));
		else
			viCheckErr( viPrintf (io, "TRIG OFF\n"));
		Delay (delay_time);
	}
	checkErr( chr66200_CheckStatus (vi));

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetTriggerMode
 * Purpose:  This function is used to select which mode will be triggered.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetTriggerMode (ViSession vi,
                                           ViInt32 mode)
{
	ViStatus	error = VI_SUCCESS;
	ViBoolean	COMPARATOR=VI_TRUE;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	checkErr( chr66200_command_not_support (vi, Model_66201, mode, 2, CHR66200_ERROR_CMD_NOT_SUPPORT));
	checkErr( chr66200_command_not_support (vi, Model_66201, mode, 3, CHR66200_ERROR_CMD_NOT_SUPPORT));
	if ( mode==1 )
	{
		checkErr( Ivi_GetAttributeViBoolean (vi, VI_NULL, CHR66200_ATTR_COMPARATOR, 0, &COMPARATOR));
		if ( COMPARATOR == VI_FALSE )
			checkErr( error= CHR66200_ERROR_COMP_STATE );
	}
	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_TRIGGER_MODE, IVI_VAL_DIRECT_USER_CALL,
											mode), 2, "Mode");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryTriggerState
 * Purpose:  This function queries the power meter's trigger state.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryTriggerState (ViSession vi,
                                              ViChar state[])
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	if (state == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for State" );

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);

		viCheckErr( viPrintf (io, "TRIG:STATE?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%s", state));
		Delay (delay_time);
	}
	else
		Fmt (state, "STOP");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetComparator
 * Purpose:  This function sets the comparator and comparator time to the
 *           power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetComparator (ViSession vi,
                                          ViBoolean comparator,
                                          ViInt32 comparatorTime)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, CHR66200_ATTR_COMPARATOR, 0,
											comparator), 2, "Comparator");

	checkErr( chr66200_running_error (vi, 1));

	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_TIME, 0,
											comparatorTime), 3, "Comparator Time");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryComparatorResult
 * Purpose:  This function queries the power meter's comparator result.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryComparatorResult (ViSession vi,
                                                  ViChar result[])
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (result == VI_NULL)
    	viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Result");

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "COMP:RESULT?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%s", result));
		Delay (delay_time);
	}
	else
		Fmt (result, "NONE");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryComparatorFailItem
 * Purpose:  This function queries the power meter's comparator fail item.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryComparatorFailItem (ViSession vi,
                                                    ViChar failItem[])
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (failItem == VI_NULL)
    	viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Fail Item");

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "COMP:FAIL?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%s", failItem));
		Delay (delay_time);
	}
	else
		Fmt (failItem, "NONE");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetComparatorItem
 * Purpose:  This function sets the power meter's comparator item.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetComparatorItem (ViSession vi,
                                              ViInt32 comparatorItemFlag)
{
	ViStatus	error = VI_SUCCESS;
	ViChar      wrBuffer[BUFFER_SIZE]="";
	ViInt64		length=0;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	checkErr( chr66200_running_error (vi, 1));

	if ( comparatorItemFlag>65535 || comparatorItemFlag<1)
		checkErr( error=Invalid_value );

	if ( (comparatorItemFlag&1) == 1)
		strcat ( wrBuffer, "V,");
	if ( (comparatorItemFlag&2) == 2)
		strcat ( wrBuffer, "VPK+,");
	if ( (comparatorItemFlag&4) == 4)
		strcat ( wrBuffer, "VPK-,");
	if ( (comparatorItemFlag&8) == 8)
	{
		checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_THD));
		strcat ( wrBuffer, "THDV,");
	}
	if ( (comparatorItemFlag&16) == 16)
		strcat ( wrBuffer, "I,");
	if ( (comparatorItemFlag&32) == 32)
		strcat ( wrBuffer, "IPK+,");
	if ( (comparatorItemFlag&64) == 64)
		strcat ( wrBuffer, "IPK-,");
	if ( (comparatorItemFlag&128) == 128)
	{
		checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_IS));
		strcat ( wrBuffer, "IS,");
	}
	if ( (comparatorItemFlag&256) == 256)
		strcat ( wrBuffer, "CFI,");
	if ( (comparatorItemFlag&512) == 512)
	{
		checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_THD));
		strcat ( wrBuffer, "THDI,");
	}
	if ( (comparatorItemFlag&1024) == 1024)
		strcat ( wrBuffer, "W,");
	if ( (comparatorItemFlag&2048) == 2048)
		strcat ( wrBuffer, "PF,");
	if ( (comparatorItemFlag&4096) == 4096)
		strcat ( wrBuffer, "VA,");
	if ( (comparatorItemFlag&8192) == 8192)
		strcat ( wrBuffer, "VAR,");
	if ( (comparatorItemFlag&16384) == 16384)
	{
		checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_ENERGY));
		strcat ( wrBuffer, "ENEG,");
	}
	if ( (comparatorItemFlag&32768) == 32768)
		strcat ( wrBuffer, "FREQ,");

	length=strlen (wrBuffer);
	if ( length > 0)
		if ( (wrBuffer[length-1]) == ',')
			wrBuffer[length-1]=0;

	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_ITEM,
                                        0, wrBuffer));

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryComparatorItem
 * Purpose:  This function queries the power meter's comparator item.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryComparatorItem (ViSession vi,
                                                ViChar comparatorItem[])
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	checkErr( Ivi_GetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_ITEM,
                                        0, BUFFER_SIZE, comparatorItem));

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetCompLimVolt
 * Purpose:  This function sets the comparator limit of voltage in GONG mode
 *           to the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetCompLimVolt (ViSession vi,
                                           ViReal64 vLOW, ViReal64 vHIGH,
                                           ViReal64 VPK_P_LOW, ViReal64 VPK_P_HIGH,
                                           ViReal64 VPK_M_LOW, ViReal64 VPK_M_HIGH,
                                           ViReal64 v_THDLOW, ViReal64 v_THDHIGH)
{
	ViStatus	error = VI_SUCCESS;
	ViChar      wrBuffer[BUFFER_SIZE]="";

	checkErr( Ivi_LockSession (vi, VI_NULL));

	checkErr( chr66200_running_error (vi, 1));

	if ( (vLOW<0.0) || (vLOW>999.9) )
		checkErr( error=Invalid_value );
	if ( (vHIGH<0.0) || (vHIGH>999.9) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,"%.4f,%.4f",vHIGH, vLOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_V,
                                        0, wrBuffer));

	if ( (VPK_P_LOW<0.0) || (VPK_P_LOW>999.9) )
		checkErr( error=Invalid_value );
	if ( (VPK_P_HIGH<0.0) || (VPK_P_HIGH>999.9) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,"%.4f,%.4f",VPK_P_HIGH, VPK_P_LOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_VPK_PLUS,
                                        0, wrBuffer));
	if ( (VPK_M_LOW<0.0) || (VPK_M_LOW>999.9) )
		checkErr( error=Invalid_value );
	if ( (VPK_M_HIGH<0.0) || (VPK_M_HIGH>999.9) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,"%.4f,%.4f",VPK_M_HIGH, VPK_M_LOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_VPK_MINUS,
                                        0, wrBuffer));

	if ( (chr66200_function_skip (vi, Model_66201))==0)
	{
		if ( (v_THDLOW<0.0) || (v_THDLOW>99.99) )
			checkErr( error=Invalid_value );
		if ( (v_THDHIGH<0.0) || (v_THDHIGH>99.99) )
			checkErr( error=Invalid_value );
		sprintf( wrBuffer,"%.4f,%.4f",v_THDHIGH, v_THDLOW);
		checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_THDV,
        	                                0, wrBuffer));
 	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetCompLimPower
 * Purpose:  This function sets the comparator limit of power to the power
 *           meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetCompLimPower (ViSession vi,
                                            ViReal64 wLOW, ViReal64 wHIGH,
                                            ViReal64 PFLOW, ViReal64 PFHIGH,
                                            ViReal64 VALOW, ViReal64 VAHIGH,
                                            ViReal64 VARLOW, ViReal64 VARHIGH,
                                            ViInt32 ENERGYLOW,
                                            ViInt32 ENERGYHIGH)
{
	ViStatus	error = VI_SUCCESS;
	ViChar      wrBuffer[BUFFER_SIZE]="";

	checkErr( Ivi_LockSession (vi, VI_NULL));

	checkErr( chr66200_running_error (vi, 1));

	if ( (wLOW<0.0) || (wLOW>9999.0) )
		checkErr( error=Invalid_value );
	if ( (wHIGH<0.0) || (wHIGH>9999.0) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,"%.4f,%.4f",wHIGH, wLOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_W,
                                        0, wrBuffer));

	if ( (PFLOW<0.0) || (PFLOW>9.999) )
		checkErr( error=Invalid_value );
	if ( (PFHIGH<0.0) || (PFHIGH>9.999) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,"%.6f,%.6f",PFHIGH, PFLOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_PF,
                                        0, wrBuffer));
	if ( (VALOW<0.0) || (VALOW>9999.0) )
		checkErr( error=Invalid_value );
	if ( (VAHIGH<0.0) || (VAHIGH>9999.0) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,"%.4f,%.4f",VAHIGH, VALOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_VA,
                                        0, wrBuffer));

	if ( (VARLOW<0.0) || (VARLOW>9999.0) )
		checkErr( error=Invalid_value );
	if ( (VARHIGH<0.0) || (VARHIGH>9999.0) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,"%.4f,%.4f",VARHIGH, VARLOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_VAR,
                                        0, wrBuffer));

	if ( (chr66200_function_skip (vi, Model_66201))==0)
	{
		if ( (ENERGYLOW<0) || (ENERGYLOW>9999) )
			checkErr( error=Invalid_value );
		if ( (ENERGYHIGH<0) || (ENERGYHIGH>9999) )
			checkErr( error=Invalid_value );
		sprintf( wrBuffer,"%d,%d",ENERGYHIGH, ENERGYLOW);
		checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_ENERGY,
        	                                0, wrBuffer));
 	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetCompLimFreq
 * Purpose:  This function sets the comparator limit of frequency to the
 *           power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetCompLimFreq (ViSession vi,
                                           ViInt32 FREQUENCYLOW,
                                           ViInt32 FREQUENCYHIGH)
{
	ViStatus	error = VI_SUCCESS;
	ViChar      wrBuffer[BUFFER_SIZE]="";

	checkErr( Ivi_LockSession (vi, VI_NULL));

	checkErr( chr66200_running_error (vi, 1));

	if ( (FREQUENCYLOW<0) || (FREQUENCYLOW>9999) )
		checkErr( error=Invalid_value );
	if ( (FREQUENCYHIGH<0) || (FREQUENCYHIGH>9999) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,"%d,%d",FREQUENCYHIGH, FREQUENCYLOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_FREQ,
                                        0, wrBuffer));

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetCompLimCurr
 * Purpose:  This function sets the comparator limit of current in GONG mode
 *           to the power meter.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetCompLimCurr (ViSession vi,
                                           ViReal64 iLOW, ViReal64 iHIGH,
                                           ViReal64 IPK_P_LOW, ViReal64 IPK_P_HIGH,
                                           ViReal64 IPK_M_LOW, ViReal64 IPK_M_HIGH,
                                           ViReal64 ISLOW, ViReal64 ISHIGH,
                                           ViReal64 CFLOW, ViReal64 CFHIGH,
                                           ViReal64 i_THDLOW, ViReal64 i_THDHIGH)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		rdBuffer[BUFFER_SIZE],modelQ[BUFFER_SIZE]="",wrBuffer[BUFFER_SIZE]="",accu[BUFFER_SIZE]="%.6f,%.6f";
	ViInt32		errCode=256,shuntRange=0;
	ViReal64 	low_lim=0.00,high1=9.999,high2=99.99,high_lim=0.00;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	checkErr( Ivi_GetAttributeViString (vi, "", CHR66200_ATTR_INSTRUMENT_MODEL,
                                        0, BUFFER_SIZE, modelQ));
	checkErr( chr66200_running_error (vi, 1));
	if ( (strncmp(modelQ,Model_66201,5)) == 0)
		high_lim=high1;
	else
	{
		checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_CURR_SHUNT, IVI_VAL_DIRECT_USER_CALL,
											&shuntRange));
		if ( shuntRange==0 )
			high_lim=high1;
		else if ( shuntRange==1 )
			high_lim=high2;
		else if ( shuntRange==2 )
		{
			ViSession   io = Ivi_IOSession(vi);
			viCheckErr( viPrintf (io, "*CLS\n"));
			checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_I));
			sprintf( wrBuffer,accu,high2, low_lim);
			checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_I,
                                        0, wrBuffer));
			checkErr( chr66200_error_query (vi, &errCode, rdBuffer));
			if ( errCode==0 ) //shunt range is high
				high_lim=high2;
			else
			{
				high_lim=high1;
				viCheckErr( viPrintf (io, "*CLS\n"));
            }
            checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_I));
		}
	}

	if ( (iLOW<low_lim) || (iLOW>high_lim) )
		checkErr( error=Invalid_value );
	if ( (iHIGH<low_lim) || (iHIGH>high_lim) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,accu,iHIGH, iLOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_I,
                                        0, wrBuffer));

	if ( (IPK_P_LOW<low_lim) || (IPK_P_LOW>high_lim) )
		checkErr( error=Invalid_value );
	if ( (IPK_P_HIGH<low_lim) || (IPK_P_HIGH>high_lim) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,accu,IPK_P_HIGH, IPK_P_LOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_IPK_PLUS,
                                        0, wrBuffer));

	if ( (IPK_M_LOW<low_lim) || (IPK_M_LOW>high_lim) )
		checkErr( error=Invalid_value );
	if ( (IPK_M_HIGH<low_lim) || (IPK_M_HIGH>high_lim) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,accu,IPK_M_HIGH, IPK_M_LOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_IPK_MINUS,
                                        0, wrBuffer));

	if ( (chr66200_function_skip (vi, Model_66201))==0)
	{
		if ( (ISLOW<low_lim) || (ISLOW>high_lim) )
			checkErr( error=Invalid_value );
		if ( (ISHIGH<low_lim) || (ISHIGH>high_lim) )
			checkErr( error=Invalid_value );
		sprintf( wrBuffer,accu,ISHIGH, ISLOW);
		checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_IS,
        	                                0, wrBuffer));
	}

	if ( (CFLOW<low_lim) || (CFLOW>high2) )
		checkErr( error=Invalid_value );
	if ( (CFHIGH<low_lim) || (CFHIGH>high2) )
		checkErr( error=Invalid_value );
	sprintf( wrBuffer,accu,CFHIGH, CFLOW);
	checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_CF,
                                        0, wrBuffer));

	if ( (chr66200_function_skip (vi, Model_66201))==0)
	{
		if ( (i_THDLOW<low_lim) || (i_THDLOW>high2) )
			checkErr( error=Invalid_value );
		if ( (i_THDHIGH<low_lim) || (i_THDHIGH>high2) )
			checkErr( error=Invalid_value );
		sprintf( wrBuffer,accu,i_THDHIGH, i_THDLOW);
		checkErr( Ivi_SetAttributeViString (vi, VI_NULL, CHR66200_ATTR_COMPARATOR_LIMIT_THDI,
        	                                0, wrBuffer));
	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetCLS
 * Purpose:  This function clears the power meter's status byte register and
 *           the event registers.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetCLS (ViSession vi)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viWrite (io, "*CLS\n", 5, VI_NULL));
		Delay (delay_time);
	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetESE
 * Purpose:  This function sets the standard event status enable register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetESE (ViSession vi,
                                   ViInt32 enableRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_STATUS_ESE, 0,
											enableRegister), 2, "Enable Register");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryESR
 * Purpose:  This function queries the power meter's contents of the standard
 *           event status register (SESR).
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryESR (ViSession vi,
                                     ViInt32 *statusRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
    if (statusRegister == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Status Register");
	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "*ESR?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%d", statusRegister));
		Delay (delay_time);
	}
	else
		*statusRegister=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetSRE
 * Purpose:  This function sets the service request enable register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetSRE (ViSession vi,
                                   ViInt32 enableRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_STATUS_SRE, 0,
											enableRegister), 2, "Enable Register");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QuerySTB
 * Purpose:  This function queries the power meter's status byte register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QuerySTB (ViSession vi,
                                     ViInt32 *statusByte)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
    if (statusByte == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Status Byte");
	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "*STB?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%d", statusByte));
		Delay (delay_time);
	}
	else
		*statusByte=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryTST
 * Purpose:  This function queries the power meter's result of self-test.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryTST (ViSession vi,
                                     ViInt32 *self_test_result)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
    if (self_test_result == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for self test result");
	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "*TST?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%d", self_test_result));
		Delay (delay_time);
	}
	else
		*self_test_result=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_Save
 * Purpose:  This function saves the value of settings to flash memory.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_Save (ViSession vi)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viWrite (io, "*SAV\n", 5, VI_NULL));
		Delay (1);
	}

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryOperStatusRegister
 * Purpose:  This function queries the Operation Status register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryOperStatusRegister (ViSession vi,
                                                    ViInt32 *operationStatusRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (operationStatusRegister == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Operation Status Register" );

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "STAT:OPER?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%d", operationStatusRegister));
		Delay (delay_time);
	}
	else
		*operationStatusRegister=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetOperStatusEnableReg
 * Purpose:  This function sets the Operation Status Enable register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetOperStatusEnableReg (ViSession vi,
                                                   ViInt32 operatonStatusEnableRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_STATUS_OPERATION_ENABLE, 0,
											operatonStatusEnableRegister), 2, "Operaton Status Enable Register");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryQuestEventReg
 * Purpose:  This function queries the Questionable Event register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryQuestEventReg (ViSession vi,
                                               ViInt32 *questionableEventRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (questionableEventRegister == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Questionable Event Register" );

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "STAT:QUES?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%d", questionableEventRegister));
		Delay (delay_time);
	}
	else
		*questionableEventRegister=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_QueryQuestCondReg
 * Purpose:  This function queries the Questionable Condition register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_QueryQuestCondReg (ViSession vi,
                                              ViInt32 *questionableConditionRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));
	if (questionableConditionRegister == VI_NULL)
		viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Questionable Condition Register" );

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "STAT:QUES:COND?\n"));
		Delay (delay_time);
		viCheckErr( viScanf (io, "%d", questionableConditionRegister));
		Delay (delay_time);
	}
	else
		*questionableConditionRegister=0;

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetQuestEnableReg
 * Purpose:  This function sets the Questionable Enable register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetQuestEnableReg (ViSession vi,
                                              ViInt32 questionableEnableRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_STATUS_QUESTIONABLE_ENABLE, 0,
											questionableEnableRegister), 2, "Questionable Enable Register");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetQuestNTRReg
 * Purpose:  This function sets the Questionable NTR register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetQuestNTRReg (ViSession vi,
                                           ViInt32 questionableNTRRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_STATUS_QUESTIONABLE_NTR, 0,
											questionableNTRRegister), 2, "Questionable NTR Register");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_SetQuestPTRReg
 * Purpose:  This function sets the Questionable PTR register.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetQuestPTRReg (ViSession vi,
                                           ViInt32 questionablePTRRegister)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_STATUS_QUESTIONABLE_PTR, 0,
											questionablePTRRegister), 2, "Questionable PTR Register");

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_PresetStatus
 * Purpose:  This function sets the Enable, PTR, and NTR register of the
 *           status groups to their power-on value.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_PresetStatus (ViSession vi)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( Ivi_LockSession (vi, VI_NULL));

	if (!Ivi_Simulating(vi))
	{
		ViSession   io = Ivi_IOSession(vi);
		viCheckErr( viPrintf (io, "STAT:PRES\n"));
		Delay (delay_time);
	}

	checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, CHR66200_ATTR_STATUS_OPERATION_ENABLE));
	checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, CHR66200_ATTR_STATUS_QUESTIONABLE_ENABLE));
	checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, CHR66200_ATTR_STATUS_QUESTIONABLE_NTR));
	checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, CHR66200_ATTR_STATUS_QUESTIONABLE_PTR));

Error:
	Ivi_UnlockSession (vi, VI_NULL);
	return error;
}

/*****************************************************************************
 * Function: chr66200_reset
 * Purpose:  This function resets the instrument.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_reset (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));

	if (!Ivi_Simulating(vi))                /* call only when locked */
	    {
	    ViSession   io = Ivi_IOSession(vi); /* call only when locked */

	    checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
	    viCheckErr( viPrintf (io, "*RST\n"));
	    Delay (shunt_range_delay_time);
	    }

	checkErr( chr66200_DefaultInstrSetup (vi));

	checkErr( chr66200_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: chr66200_ResetWithDefaults
 * Purpose:  This function resets the instrument and applies default settings
 *           from the IVI Configuration Store based on the logical name
 *           from which the session was created.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_ResetWithDefaults (ViSession vi)
{
    ViStatus error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    checkErr( chr66200_reset(vi));
    checkErr( Ivi_ApplyDefaultSetup(vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/****************************************************************************
 *  Function: chr66200_Disable
 *  Purpose:  This function places the instrument in a quiescent state as
 *            quickly as possible.
 ****************************************************************************/
ViStatus _VI_FUNC chr66200_Disable (ViSession vi)
{
    ViStatus error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    if (!Ivi_Simulating(vi)) {
        //Place appropriate code here to disable the instrument.
    }

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: chr66200_self_test
 * Purpose:  This function executes the instrument self-test and returns the
 *           result.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_self_test (ViSession vi, ViInt16 *testResult,
                                      ViChar testMessage[])
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (testResult == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Test Result");
    if (testMessage == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Test Message");

	viCheckWarn( VI_WARN_NSUP_SELF_TEST);

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: chr66200_error_query
 * Purpose:  This function queries the instrument error queue and returns
 *           the result.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_error_query (ViSession vi, ViInt32 *errCode,
                                        ViChar errMessage[])
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (errCode == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Error Code");
    if (errMessage == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Error Message");

	if (!Ivi_Simulating(vi))                /* call only when locked */
	    {
	    ViSession   io = Ivi_IOSession(vi); /* call only when locked */

	    checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
	    viCheckErr( viPrintf(io, ":SYST:ERR?\n"));

		viCheckErr( viScanf (io, "%ld,\"%256[^\"]", errCode, errMessage));

	    }
	else
	    {
	        /* Simulate Error Query */
	    *errCode = 0;
	    strcpy (errMessage, "No error.");
	    }

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: chr66200_error_message
 * Purpose:  This function translates the error codes returned by this
 *           instrument driver into user-readable strings.
 *
 *           Note:  The caller can pass VI_NULL for the vi parameter.  This
 *           is useful if one of the init functions fail.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_error_message (ViSession vi, ViStatus errorCode,
                                          ViChar errorMessage[256])
{
    ViStatus    error = VI_SUCCESS;

    static      IviStringValueTable errorTable =
        {
        	{CHR66200_ERROR_CMD_NOT_SUPPORT,		"Model 66201 do not support the function."},
        	{CHR66200_ERROR_EXECUTION,				"Execution error! Use Error-Query function to detect error."},
        	{CHR66200_ERROR_THD,					"Model 66201 do not support the THD function."},
        	{CHR66200_ERROR_IS,						"Model 66201 do not support the inrush current function."},
        	{CHR66200_ERROR_ENERGY,					"Model 66201 do not support the energy function."},
        	{CHR66200_ERROR_CALIB_FAIL,				"Calibration fail."},
        	{CHR66200_ERROR_STATE_GONG,				"Trigger mode is GONG and trigger state is running."},
        	{CHR66200_ERROR_STATE_IS,				"Trigger mode is INRUSH and trigger state is running."},
        	{CHR66200_ERROR_STATE_ENERGY,			"Trigger mode is ENERGY and trigger state is running."},
        	{CHR66200_ERROR_TRIG_ON,				"Trigger mode is NONE or trigger state is running."},
        	{CHR66200_ERROR_TRIG_OFF,				"Trigger state is not running."},
        	{CHR66200_ERROR_COMP_STATE,				"Compartor is OFF."},
        	{CHR66200_ERROR_WAVCAP_FAIL,			"Waveform capture fail."},
        	{CHR66200_ERROR_WAVEFORM_READ,			"Waveform data read error."},
            {VI_NULL,                               VI_NULL}
        };

    if (vi)
        Ivi_LockSession(vi, VI_NULL);

        /* all VISA and IVI error codes are handled as well as codes in the table */
    if (errorMessage == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Error Message");

    checkErr( Ivi_GetSpecificDriverStatusDesc(vi, errorCode, errorMessage, errorTable));

Error:
    if (vi)
        Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: chr66200_InvalidateAllAttributes
 * Purpose:  This function invalidates the cached value of all attributes.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_InvalidateAllAttributes (ViSession vi)
{
	return Ivi_InvalidateAllAttributes(vi);
}

/*****************************************************************************
 * Function: chr66200_revision_query
 * Purpose:  This function returns the driver and instrument revisions.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_revision_query (ViSession vi, ViChar driverRev[],
                                           ViChar instrRev[])
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (driverRev == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Driver Revision");
    if (instrRev == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Instrument Revision");

    checkErr( Ivi_GetAttributeViString (vi, VI_NULL, CHR66200_ATTR_SPECIFIC_DRIVER_REVISION,
                                        0, 256, driverRev));
    checkErr( Ivi_GetAttributeViString (vi, "", CHR66200_ATTR_INSTRUMENT_FIRMWARE_REVISION,
                                        0, 256, instrRev));
    checkErr( chr66200_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}


/*****************************************************************************
 * Function: chr66200_GetAttribute<type> Functions
 * Purpose:  These functions enable the instrument driver user to get
 *           attribute values directly.  There are typesafe versions for
 *           ViInt32, ViReal64, ViString, ViBoolean, and ViSession attributes.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_GetAttributeViInt32 (ViSession vi, ViConstString channelName,
                                                ViAttr attributeId, ViInt32 *value)
{
    return Ivi_GetAttributeViInt32 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                    value);
}
ViStatus _VI_FUNC chr66200_GetAttributeViReal64 (ViSession vi, ViConstString channelName,
                                                 ViAttr attributeId, ViReal64 *value)
{
    return Ivi_GetAttributeViReal64 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                     value);
}
ViStatus _VI_FUNC chr66200_GetAttributeViString (ViSession vi, ViConstString channelName,
                                                 ViAttr attributeId, ViInt32 bufSize,
                                                 ViChar value[])
{
    return Ivi_GetAttributeViString (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                     bufSize, value);
}
ViStatus _VI_FUNC chr66200_GetAttributeViBoolean (ViSession vi, ViConstString channelName,
                                                  ViAttr attributeId, ViBoolean *value)
{
    return Ivi_GetAttributeViBoolean (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                      value);
}
ViStatus _VI_FUNC chr66200_GetAttributeViSession (ViSession vi, ViConstString channelName,
                                                  ViAttr attributeId, ViSession *value)
{
    return Ivi_GetAttributeViSession (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                      value);
}

/*****************************************************************************
 * Function: chr66200_SetAttribute<type> Functions
 * Purpose:  These functions enable the instrument driver user to set
 *           attribute values directly.  There are typesafe versions for
 *           ViInt32, ViReal64, ViString, ViBoolean, and ViSession datatypes.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_SetAttributeViInt32 (ViSession vi, ViConstString channelName,
                                                ViAttr attributeId, ViInt32 value)
{
    return Ivi_SetAttributeViInt32 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                    value);
}
ViStatus _VI_FUNC chr66200_SetAttributeViReal64 (ViSession vi, ViConstString channelName,
                                                 ViAttr attributeId, ViReal64 value)
{
    return Ivi_SetAttributeViReal64 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                     value);
}
ViStatus _VI_FUNC chr66200_SetAttributeViString (ViSession vi, ViConstString channelName,
                                                 ViAttr attributeId, ViConstString value)
{
    return Ivi_SetAttributeViString (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                     value);
}
ViStatus _VI_FUNC chr66200_SetAttributeViBoolean (ViSession vi, ViConstString channelName,
                                                  ViAttr attributeId, ViBoolean value)
{
    return Ivi_SetAttributeViBoolean (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                      value);
}
ViStatus _VI_FUNC chr66200_SetAttributeViSession (ViSession vi, ViConstString channelName,
                                                  ViAttr attributeId, ViSession value)
{
    return Ivi_SetAttributeViSession (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                      value);
}

/*****************************************************************************
 * Function: chr66200_CheckAttribute<type> Functions
 * Purpose:  These functions enable the instrument driver user to check
 *           attribute values directly.  These functions check the value you
 *           specify even if you set the CHR66200_ATTR_RANGE_CHECK
 *           attribute to VI_FALSE.  There are typesafe versions for ViInt32,
 *           ViReal64, ViString, ViBoolean, and ViSession datatypes.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_CheckAttributeViInt32 (ViSession vi, ViConstString channelName,
                                                  ViAttr attributeId, ViInt32 value)
{
    return Ivi_CheckAttributeViInt32 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                      value);
}
ViStatus _VI_FUNC chr66200_CheckAttributeViReal64 (ViSession vi, ViConstString channelName,
                                                   ViAttr attributeId, ViReal64 value)
{
    return Ivi_CheckAttributeViReal64 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                       value);
}
ViStatus _VI_FUNC chr66200_CheckAttributeViString (ViSession vi, ViConstString channelName,
                                                   ViAttr attributeId, ViConstString value)
{
    return Ivi_CheckAttributeViString (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                       value);
}
ViStatus _VI_FUNC chr66200_CheckAttributeViBoolean (ViSession vi, ViConstString channelName,
                                                    ViAttr attributeId, ViBoolean value)
{
    return Ivi_CheckAttributeViBoolean (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                        value);
}
ViStatus _VI_FUNC chr66200_CheckAttributeViSession (ViSession vi, ViConstString channelName,
                                                    ViAttr attributeId, ViSession value)
{
    return Ivi_CheckAttributeViSession (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL,
                                        value);
}

/*****************************************************************************
 * Function: chr66200_GetNextCoercionRecord
 * Purpose:  This function enables the instrument driver user to obtain
 *           the coercion information associated with the IVI session.
 *           This function retrieves and clears the oldest instance in which
 *           the instrument driver coerced a value the instrument driver user
 *           specified to another value.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_GetNextCoercionRecord (ViSession vi,
                                                  ViInt32 bufferSize,
                                                  ViChar  record[])
{
    return Ivi_GetNextCoercionString (vi, bufferSize, record);
}

/****************************************************************************
 *  Function: chr66200_GetNextInterchangeWarning,
 *            chr66200_ResetInterchangeCheck, and
 *            chr66200_ClearInterchangeWarnings
 *  Purpose:  These functions allow the user to retrieve interchangeability
 *            warnings, reset the driver's interchangeability checking
 *            state, and clear all previously logged interchangeability warnings.
 ****************************************************************************/
ViStatus _VI_FUNC chr66200_GetNextInterchangeWarning (ViSession vi,
                                                      ViInt32 bufferSize,
                                                      ViChar warnString[])
{
    return Ivi_GetNextInterchangeCheckString (vi, bufferSize, warnString);
}

ViStatus _VI_FUNC chr66200_ResetInterchangeCheck (ViSession vi)
{
    return Ivi_ResetInterchangeCheck (vi);
}

ViStatus _VI_FUNC chr66200_ClearInterchangeWarnings (ViSession vi)
{
    return Ivi_ClearInterchangeWarnings (vi);
}

/*****************************************************************************
 * Function: chr66200_LockSession and chr66200_UnlockSession Functions
 * Purpose:  These functions enable the instrument driver user to lock the
 *           session around a sequence of driver calls during which other
 *           execution threads must not disturb the instrument state.
 *
 *           NOTE:  The callerHasLock parameter must be a local variable
 *           initialized to VI_FALSE and passed by reference, or you can pass
 *           VI_NULL.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_LockSession (ViSession vi, ViBoolean *callerHasLock)
{
    return Ivi_LockSession(vi,callerHasLock);
}
ViStatus _VI_FUNC chr66200_UnlockSession (ViSession vi, ViBoolean *callerHasLock)
{
    return Ivi_UnlockSession(vi,callerHasLock);
}

/*****************************************************************************
 * Function: chr66200_GetError and chr66200_ClearError Functions
 * Purpose:  These functions enable the instrument driver user to
 *           get or clear the error information the driver associates with the
 *           IVI session.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_GetError (ViSession vi, ViStatus *errorCode,
                            ViInt32 bufferSize, ViChar description[])
{
    ViStatus error = VI_SUCCESS;
    ViStatus primary = VI_SUCCESS,
             secondary = VI_SUCCESS;
    ViChar   elaboration[256] = "";
    ViChar   errorMessage[1024] = "";
    ViChar  *appendPoint = errorMessage;
    ViInt64  actualSize = 0;
    ViBoolean locked = VI_FALSE;

    /* Lock Session */
    if (vi != 0)
        {
        checkErr( Ivi_LockSession(vi, &locked));
        }

    /* Test for nulls and acquire error data */
    if (bufferSize != 0)
        {
        if (errorCode == VI_NULL)
            {
            viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Error");
            }
        if (description == VI_NULL)
            {
            viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for Description");
            }
        checkErr( Ivi_GetErrorInfo (vi, &primary, &secondary, elaboration));
        }

    else
        {
        checkErr( Ivi_GetAttributeViString(vi, VI_NULL, IVI_ATTR_ERROR_ELABORATION, 0, 256, elaboration));
        checkErr( Ivi_GetAttributeViInt32(vi, VI_NULL, IVI_ATTR_SECONDARY_ERROR, 0, &secondary));
        checkErr( Ivi_GetAttributeViInt32(vi, VI_NULL, IVI_ATTR_PRIMARY_ERROR, 0, &primary));
        }

    /* Format data */
    if (primary != VI_SUCCESS)
        {
        ViChar msg[256] = "";
        checkErr( chr66200_error_message (vi, primary, msg));
        appendPoint += sprintf(appendPoint, "Primary Error: (Hex 0x%08X) %s", primary, msg);
        }

    if (secondary != VI_SUCCESS)
        {
        ViChar msg[256] = "";
        checkErr( chr66200_error_message (vi, secondary, msg));
        appendPoint += sprintf(appendPoint, "\nSecondary Error: (Hex 0x%08X) %s", secondary, msg);
        }

    if (elaboration[0])
        {
        sprintf(appendPoint, "\nElaboration: %s", elaboration);
        }

    actualSize = strlen(errorMessage) + 1;

    /* Prepare return values */
    if (bufferSize == 0)
        {
        error = actualSize;
        }
    else
        {
        if (bufferSize > 0)
            {
            if (actualSize > bufferSize)
                {
                error = actualSize;
                actualSize = bufferSize;
                }
            }
        memcpy(description, errorMessage, actualSize-1);
        description[actualSize-1] = '\0';
        }

    if (errorCode)
        {
        *errorCode = primary;
        }

Error:
    /* Unlock Session */
    Ivi_UnlockSession (vi, &locked);

    return error;
}

ViStatus _VI_FUNC chr66200_ClearError (ViSession vi)
{
    return Ivi_ClearErrorInfo (vi);
}

/*****************************************************************************
 * Function: chr66200_GetErrorInfo and chr66200_ClearErrorInfo Functions
 * Purpose:  These functions enable the instrument driver user to
 *           get or clear the error information the driver associates with the
 *           IVI session.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_GetErrorInfo (ViSession vi, ViStatus *primaryError,
                                         ViStatus *secondaryError, ViChar errorElaboration[256])
{
    return Ivi_GetErrorInfo(vi, primaryError, secondaryError, errorElaboration);
}
ViStatus _VI_FUNC chr66200_ClearErrorInfo (ViSession vi)
{
    return Ivi_ClearErrorInfo (vi);
}

/*****************************************************************************
 * Function: WriteInstrData and ReadInstrData Functions
 * Purpose:  These functions enable the instrument driver user to
 *           write and read commands directly to and from the instrument.
 *
 *           Note:  These functions bypass the IVI attribute state caching.
 *                  WriteInstrData invalidates the cached values for all
 *                  attributes.
 *****************************************************************************/
ViStatus _VI_FUNC chr66200_WriteInstrData (ViSession vi, ViConstString writeBuffer)
{
    return Ivi_WriteInstrData (vi, writeBuffer);
}
ViStatus _VI_FUNC chr66200_ReadInstrData (ViSession vi, ViInt32 numBytes,
                                          ViChar rdBuf[], ViInt32 *bytesRead)
{
    return Ivi_ReadInstrData (vi, numBytes, rdBuf, bytesRead);
}

/*****************************************************************************
 *-------------------- Utility Functions (Not Exported) ---------------------*
 *****************************************************************************/

/*****************************************************************************
 * Function: chr66200_CheckStatus
 * Purpose:  This function checks the status of the instrument to detect
 *           whether the instrument has encountered an error.  This function
 *           is called at the end of most exported driver functions.  If the
 *           instrument reports an error, this function returns
 *           IVI_ERROR_INSTR_SPECIFIC.  The user can set the
 *           IVI_ATTR_QUERY_INSTR_STATUS attribute to VI_FALSE to disable this
 *           check and increase execution speed.
 *
 *           Note:  Call this function only when the session is locked.
 *****************************************************************************/
static ViStatus chr66200_CheckStatus (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;

    if (Ivi_QueryInstrStatus (vi) && Ivi_NeedToCheckStatus (vi) && !Ivi_Simulating (vi))
        {
        checkErr( chr66200_CheckStatusCallback (vi, Ivi_IOSession(vi)));
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_FALSE));
        }

Error:
    return error;
}

/*****************************************************************************
 * Function: chr66200_WaitForOPC
 * Purpose:  This function waits for the instrument to complete the
 *           execution of all pending operations.  This function is a
 *           wrapper for the WaitForOPCCallback.  It can be called from
 *           other instrument driver functions.
 *
 *           The maxTime parameter specifies the maximum time to wait for
 *           operation complete in milliseconds.
 *
 *           Note:  Call this function only when the session is locked.
 *****************************************************************************/
static ViStatus chr66200_WaitForOPC (ViSession vi, ViInt32 maxTime)
{
    ViStatus    error = VI_SUCCESS;

    if (!Ivi_Simulating(vi))
        {
        ViInt32  oldOPCTimeout;

        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_OPC_TIMEOUT,
                                           0, &oldOPCTimeout));
        Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_OPC_TIMEOUT,
                                 0, maxTime);

        error = chr66200_WaitForOPCCallback (vi, Ivi_IOSession(vi));

        Ivi_SetAttributeViInt32 (vi, VI_NULL, CHR66200_ATTR_OPC_TIMEOUT,
                                 0, oldOPCTimeout);
        viCheckErr( error);
        }
Error:
    return error;
}

/*****************************************************************************
 * Function: chr66200_DefaultInstrSetup
 * Purpose:  This function sends a default setup to the instrument.  The
 *           chr66200_reset function calls this function.  The
 *           chr66200_IviInit function calls this function when the
 *           user passes VI_FALSE for the reset parameter.  This function is
 *           useful for configuring settings that other instrument driver
 *           functions require.
 *
 *           Note:  Call this function only when the session is locked.
 *****************************************************************************/
static ViStatus chr66200_DefaultInstrSetup (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;

    /* Invalidate all attributes */
    checkErr( Ivi_InvalidateAllAttributes (vi));

    if (!Ivi_Simulating(vi))
        {
        ViSession   io = Ivi_IOSession(vi); /* call only when locked */

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
		viCheckErr( viPrintf (io, "*CLS;*ESE 1;*SRE 32\n"));
		viCheckErr( viPrintf (io, "SYST:HEAD OFF\n"));
        }
Error:
    return error;
}

/*****************************************************************************
 * Function: ReadToFile and WriteFromFile Functions
 * Purpose:  Functions for instrument driver developers to read/write
 *           instrument data to/from a file.
 *****************************************************************************/
static ViStatus chr66200_ReadToFile (ViSession vi, ViConstString filename,
                                     ViInt32 maxBytesToRead, ViInt32 fileAction,
                                     ViInt32 *totalBytesWritten)
{
    return Ivi_ReadToFile (vi, filename, maxBytesToRead, fileAction, totalBytesWritten);
}
static ViStatus chr66200_WriteFromFile (ViSession vi, ViConstString filename,
                                        ViInt32 maxBytesToWrite, ViInt32 byteOffset,
                                        ViInt32 *totalBytesWritten)
{
    return Ivi_WriteFromFile (vi, filename, maxBytesToWrite, byteOffset, totalBytesWritten);
}

/*****************************************************************************
 *------------------------ Global Session Callbacks -------------------------*
 *****************************************************************************/

/*****************************************************************************
 * Function: chr66200_CheckStatusCallback
 * Purpose:  This function queries the instrument to determine if it has
 *           encountered an error.  If the instrument has encountered an
 *           error, this function returns the IVI_ERROR_INSTRUMENT_SPECIFIC
 *           error code.  This function is called by the
 *           chr66200_CheckStatus utility function.  The
 *           Ivi_SetAttribute and Ivi_GetAttribute functions invoke this
 *           function when the optionFlags parameter includes the
 *           IVI_VAL_DIRECT_USER_CALL flag.
 *
 *           The user can disable calls to this function by setting the
 *           IVI_ATTR_QUERY_INSTR_STATUS attribute to VI_FALSE.  The driver can
 *           disable the check status callback for a particular attribute by
 *           setting the IVI_VAL_DONT_CHECK_STATUS flag.
 *****************************************************************************/
static ViStatus _VI_FUNC chr66200_CheckStatusCallback (ViSession vi, ViSession io)
{
    ViStatus    error = VI_SUCCESS;
    ViInt16     esr = 0;

	viCheckErr( viQueryf (io, "*ESR?\n", "%hd", &esr));

	if ((esr & IEEE_488_2_QUERY_ERROR_BIT) ||
		(esr & IEEE_488_2_EXECUTION_ERROR_BIT) ||
		(esr & IEEE_488_2_COMMAND_ERROR_BIT))
		{
	       viCheckErr( IVI_ERROR_INSTR_SPECIFIC);
	    }

Error:
    return error;
}

/*****************************************************************************
 * Function: chr66200_WaitForOPCCallback
 * Purpose:  This function waits until the instrument has finished processing
 *           all pending operations.  This function is called by the
 *           chr66200_WaitForOPC utility function.  The IVI engine invokes
 *           this function in the following two cases:
 *           - Before invoking the read callback for attributes for which the
 *             IVI_VAL_WAIT_FOR_OPC_BEFORE_READS flag is set.
 *           - After invoking the write callback for attributes for which the
 *             IVI_VAL_WAIT_FOR_OPC_AFTER_WRITES flag is set.
 *****************************************************************************/
static ViStatus _VI_FUNC chr66200_WaitForOPCCallback (ViSession vi, ViSession io)
{
    ViStatus    error = VI_SUCCESS;

    return error;
}

/*****************************************************************************
 *----------------- Attribute Range Tables and Callbacks --------------------*
 *****************************************************************************/

/*- CHR66200_ATTR_ID_QUERY_RESPONSE -*/

static ViStatus _VI_FUNC chr66200AttrIdQueryResponse_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      rdBuffer[BUFFER_SIZE];
    ViUInt32    retCnt;

    viCheckErr( viPrintf (io, "*IDN?\n"));
    viCheckErr( viRead (io, rdBuffer, BUFFER_SIZE-1, &retCnt));
    rdBuffer[retCnt] = 0;

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, rdBuffer));

Error:
    return error;
}

/*- CHR66200_ATTR_SPECIFIC_DRIVER_REVISION -*/

static ViStatus _VI_FUNC chr66200AttrDriverRevision_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      driverRevision[256];


    sprintf (driverRevision,
             "Driver: chr66200 %.2f, Compiler: %s %3.2f, "
             "Components: IVIEngine %.2f, VISA-Spec %.2f",
             CHR66200_MAJOR_VERSION + CHR66200_MINOR_VERSION/1000.0,
             IVI_COMPILER_NAME, IVI_COMPILER_VER_NUM,
             IVI_ENGINE_MAJOR_VERSION + IVI_ENGINE_MINOR_VERSION/1000.0,
             Ivi_ConvertVISAVer(VI_SPEC_VERSION));

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, driverRevision));
Error:
    return error;
}


/*- CHR66200_ATTR_INSTRUMENT_FIRMWARE_REVISION -*/

static ViStatus _VI_FUNC chr66200AttrFirmwareRevision_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      instrRev[BUFFER_SIZE];

    viCheckErr( viPrintf (io, "*IDN?\n"));

	viCheckErr( viScanf (io, "%*[^,],%*[^,],%*[^,],%256[^,]", instrRev));

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, instrRev));

Error:
    return error;
}

/*- CHR66200_ATTR_INSTRUMENT_MANUFACTURER -*/

static ViStatus _VI_FUNC chr66200AttrInstrumentManufacturer_ReadCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      rdBuffer[BUFFER_SIZE];
    ViChar      idQ[BUFFER_SIZE];

    checkErr( Ivi_GetAttributeViString (vi, "", CHR66200_ATTR_ID_QUERY_RESPONSE,
                                        0, BUFFER_SIZE, idQ));
    sscanf (idQ, "%256[^,]", rdBuffer);

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, rdBuffer));

Error:
    return error;
}



/*- CHR66200_ATTR_INSTRUMENT_MODEL -*/

static ViStatus _VI_FUNC chr66200AttrInstrumentModel_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      rdBuffer[BUFFER_SIZE];
    ViChar      idQ[BUFFER_SIZE];

    checkErr( Ivi_GetAttributeViString (vi, "", CHR66200_ATTR_ID_QUERY_RESPONSE,
                                        0, BUFFER_SIZE, idQ));
    sscanf (idQ, "%*[^,],%256[^,]", rdBuffer);

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, rdBuffer));

Error:
    return error;
}

static ViStatus _VI_FUNC chr66200AttrCurrShunt_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[8];

	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_CMD_NOT_SUPPORT));

	viCheckErr( viPrintf (io, "CURR:SHUN?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,"LOW") == 0)
		*value=0;
	else if(stricmp(state,"HIGH") == 0)
		*value=1;
	else if(stricmp(state,"AUTO") == 0)
		*value=2;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrCurrShunt_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;
	ViString	Cmd;

	checkErr( Ivi_GetViInt32EntryFromIndex (value, &attrCurrShuntRangeTable, VI_NULL, VI_NULL,
												VI_NULL, &Cmd, VI_NULL));
	viCheckErr( viPrintf (io, "CURR:SHUN %s\n", Cmd));
	Delay (shunt_range_delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrCurrRange_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[8];

	viCheckErr( viPrintf (io, "CURR:RANG?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,"A001") == 0)
		*value=0;
	else if(stricmp(state,"A01") == 0)
		*value=1;
	else if(stricmp(state,"A04") == 0)
		*value=2;
	else if(stricmp(state,"A2L") == 0)
		*value=3;
	else if(stricmp(state,"A02") == 0)
		*value=4;
	else if(stricmp(state,"A2H") == 0)
		*value=5;
	else if(stricmp(state,"A8") == 0)
		*value=6;
	else if(stricmp(state,"A20") == 0)
		*value=7;
	else if(stricmp(state,"AUTO") == 0)
		*value=8;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrCurrRange_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;
	ViString	Cmd;
	ViChar		Cmd1[BUFFER_SIZE],modelQ[BUFFER_SIZE]="";

	checkErr( Ivi_GetViInt32EntryFromIndex (value, &attrCurrRangeRangeTable, VI_NULL, VI_NULL,
												VI_NULL, &Cmd, VI_NULL));

	if ( value==3 )
	{
		checkErr( Ivi_GetAttributeViString (vi, "", CHR66200_ATTR_INSTRUMENT_MODEL,
        	                                0, BUFFER_SIZE, modelQ));
		if ( strncmp(modelQ,Model_66201,5) == 0 )
			sprintf( Cmd,"A2");
	}
	sprintf( Cmd1,"CURR:RANG %s\n",Cmd);
	viCheckErr( viPrintf (io, "%s", Cmd1));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrTriggerMode_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[10];

	viCheckErr( viPrintf (io, "TRIG:MODE?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,"NONE") == 0)
		*value=0;
	else if(stricmp(state,"GONG") == 0)
		*value=1;
	else if(stricmp(state,"INRUSH") == 0)
		*value=2;
	else if(stricmp(state,"ENERGY") == 0)
		*value=3;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrTriggerMode_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;
	ViString	Cmd;
	ViChar		Cmd1[BUFFER_SIZE];

	checkErr( Ivi_GetViInt32EntryFromIndex (value, &attrTriggerModeRangeTable, VI_NULL, VI_NULL,
												VI_NULL, &Cmd, VI_NULL));
	sprintf( Cmd1,"TRIG:MODE %s",Cmd);
	viCheckErr( viPrintf (io, "%s\n", Cmd1));
	Delay (delay_time);

Error:
	return error;
}


static ViStatus _VI_FUNC chr66200AttrInrushLevel_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_IS));

	viCheckErr( viPrintf (io, "CURR:INR:TRIG:LEVEL?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrInrushLevel_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "CURR:INR:TRIG:LEVEL %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrInrushTime_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_IS));

	viCheckErr( viPrintf (io, "CURR:INR:TRIG:TIME?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrInrushTime_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "CURR:INR:TRIG:TIME %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrInrushDelay_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_IS));

	viCheckErr( viPrintf (io, "CURR:INR:TRIG:DELAY?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrInrushDelay_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "CURR:INR:TRIG:DELAY %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrVoltRange_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[8];

	viCheckErr( viPrintf (io, "VOLT:RANG?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,"V150") == 0)
		*value=0;
	else if(stricmp(state,"V300") == 0)
		*value=1;
	else if(stricmp(state,"V500") == 0)
		*value=2;
	else if(stricmp(state,"AUTO") == 0)
		*value=3;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrVoltRange_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;
	ViString	Cmd;

	checkErr( Ivi_GetViInt32EntryFromIndex (value, &attrVoltRangeRangeTable, VI_NULL, VI_NULL,
												VI_NULL, &Cmd, VI_NULL));
	viCheckErr( viPrintf (io, "VOLT:RANG %s\n", Cmd));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrAverage_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "MEAS:AVER?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrAverage_WriteCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "MEAS:AVER %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrPowerIntegrate_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "POWER:INTEGRATE?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrPowerIntegrate_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "POWER:INTEGRATE %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrFilter_ReadCallback (ViSession vi,
                                                          ViSession io,
                                                          ViConstString channelName,
                                                          ViAttr attributeId,
                                                          ViBoolean *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[8];

	viCheckErr( viPrintf (io, "FILTER?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,ON_STRING) == 0)
		*value=VI_TRUE;
	else if(stricmp(state,OFF_STRING) == 0)
		*value=VI_FALSE;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrFilter_WriteCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViBoolean value)
{
	ViStatus	error = VI_SUCCESS;

	if ( value == VI_TRUE)
	{
		viCheckErr( viPrintf (io, "FILTER ON\n"));
		Delay (delay_time);
	}
	else if ( value == VI_FALSE)
	{
		viCheckErr( viPrintf (io, "FILTER OFF\n"));
		Delay (delay_time);
	}

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrEnergyMode_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViBoolean *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[10];

	viCheckErr( viPrintf (io, "ENER:MODE?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,ENERGY_JOULE) == 0)
		*value=VI_TRUE;
	else if(stricmp(state,ENERGY_WHR) == 0)
		*value=VI_FALSE;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrEnergyMode_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViBoolean value)
{
	ViStatus	error = VI_SUCCESS;

	if ( value == VI_TRUE)
	{
		viCheckErr( viPrintf (io, "ENER:MODE %s\n", ENERGY_JOULE));
		Delay (delay_time);
	}
	else if ( value == VI_FALSE)
	{
		viCheckErr( viPrintf (io, "ENER:MODE %s\n", ENERGY_WHR));
		Delay (delay_time);
	}

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrEnergyTime_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_ENERGY));

	viCheckErr( viPrintf (io, "ENERGY:TIME?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrEnergyTime_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "ENERGY:TIME %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrThdMode_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViBoolean *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[8];

	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_THD));
	viCheckErr( viPrintf (io, "THD:MODE?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,"FULL") == 0)
		*value=VI_TRUE;
	else if(stricmp(state,"ORDER") == 0)
		*value=VI_FALSE;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrThdMode_WriteCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViBoolean value)
{
	ViStatus	error = VI_SUCCESS;

	if ( value == VI_TRUE)
	{
		viCheckErr( viPrintf (io, "THD:MODE FULL\n"));
		Delay (delay_time);
	}
	else if ( value == VI_FALSE)
	{
		viCheckErr( viPrintf (io, "THD:MODE ORDER\n"));
		Delay (delay_time);
	}

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrThdOrder_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	checkErr( chr66200_command_not_support (vi, Model_66201, 1, 1, CHR66200_ERROR_THD));

	viCheckErr( viPrintf (io, "THD:ORDER?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrThdOrder_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "THD:ORDER %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparator_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViBoolean *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[8];

	viCheckErr( viPrintf (io, "COMP?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,ON_STRING) == 0)
		*value=VI_TRUE;
	else if(stricmp(state,OFF_STRING) == 0)
		*value=VI_FALSE;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparator_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViBoolean value)
{
	ViStatus	error = VI_SUCCESS;

	if ( value == VI_TRUE)
	{
		viCheckErr( viPrintf (io, "COMP ON\n"));
		Delay (delay_time);
	}
	else if ( value == VI_FALSE)
	{
		viCheckErr( viPrintf (io, "COMP OFF\n"));
		Delay (delay_time);
	}

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorTime_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "COMP:TIME?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorTime_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "COMP:TIME %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorItem_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      rdBuffer[BUFFER_SIZE]="";
    ViUInt32    retCnt;

    viCheckErr( viPrintf (io, "COMP:ITEM?\n"));
    Delay (delay_time);
    viCheckErr( viRead (io, rdBuffer, BUFFER_SIZE-1, &retCnt));
    Delay (delay_time);

    if ( rdBuffer[retCnt-1]==0x0A )
    	rdBuffer[retCnt-1] = 0;
    else
    	rdBuffer[retCnt] = 0;

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, rdBuffer));

Error:
    return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorItem_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:ITEM %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitV_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:V %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitVpkPlus_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:VPK+ %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitVpkMinus_WriteCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:VPK- %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitThdv_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:THDV %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitW_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:W %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitPf_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:PF %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitVa_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:VA %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitVar_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:VAR %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitEnergy_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:ENEG %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitFreq_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:FREQ %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitI_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:I %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitIpkPlus_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:IPK+ %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitIpkMinus_WriteCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:IPK- %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitIs_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:IS %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitCf_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:CFI %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrComparatorLimitThdi_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViConstString value)
{
	ViStatus	error = VI_SUCCESS;
	viCheckErr( viPrintf (io, "COMP:LIM:THDI %s\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusEse_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "*ESE?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusEse_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "*ESE %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusSre_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "*SRE?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusSre_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "*SRE %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusOperationEnable_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "STAT:OPER:ENAB?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusOperationEnable_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "STAT:OPER:ENAB %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusQuestionableEnable_ReadCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "STAT:QUES:ENAB?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusQuestionableEnable_WriteCallback (ViSession vi,
                                                                             ViSession io,
                                                                             ViConstString channelName,
                                                                             ViAttr attributeId,
                                                                             ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "STAT:QUES:ENAB %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusQuestionableNtr_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "STAT:QUES:NTR?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusQuestionableNtr_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "STAT:QUES:NTR %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusQuestionablePtr_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "STAT:QUES:PTR?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%d", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrStatusQuestionablePtr_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "STAT:QUES:PTR %d\n", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrMeasMode_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViBoolean *value)
{
	ViStatus	error = VI_SUCCESS;
	ViChar		state[10];

	viCheckErr( viPrintf (io, "MEAS:MODE?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%s", state));
	Delay (delay_time);

	if(stricmp(state,"WINDOW") == 0)
		*value=VI_TRUE;
	else if(stricmp(state,"AVERAGE") == 0)
		*value=VI_FALSE;

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrMeasMode_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViBoolean value)
{
	ViStatus	error = VI_SUCCESS;

	if ( value == VI_TRUE)
	{
		viCheckErr( viPrintf (io, "MEAS:MODE WINDOW\n"));
		Delay (delay_time);
	}
	else if ( value == VI_FALSE)
	{
		viCheckErr( viPrintf (io, "MEAS:MODE AVERAGE\n"));
		Delay (delay_time);
	}

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrWindow_ReadCallback (ViSession vi,
                                                          ViSession io,
                                                          ViConstString channelName,
                                                          ViAttr attributeId,
                                                          ViReal64 *value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "MEAS:WIND?\n"));
	Delay (delay_time);
	viCheckErr( viScanf (io, "%f", value));
	Delay (delay_time);

Error:
	return error;
}

static ViStatus _VI_FUNC chr66200AttrWindow_WriteCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViReal64 value)
{
	ViStatus	error = VI_SUCCESS;

	viCheckErr( viPrintf (io, "MEAS:WIND %.1f\n", value));
	Delay (delay_time);

Error:
	return error;
}

/*****************************************************************************
 * Function: chr66200_InitAttributes
 * Purpose:  This function adds attributes to the IVI session, initializes
 *           instrument attributes, and sets attribute invalidation
 *           dependencies.
 *****************************************************************************/
static ViStatus chr66200_InitAttributes (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     flags = 0;

        /*- Initialize instrument attributes --------------------------------*/

    checkErr( Ivi_SetAttributeViInt32 (vi, "", CHR66200_ATTR_SPECIFIC_DRIVER_MAJOR_VERSION,
                                       0, CHR66200_MAJOR_VERSION));
    checkErr( Ivi_SetAttributeViInt32 (vi, "", CHR66200_ATTR_SPECIFIC_DRIVER_MINOR_VERSION,
                                       0, CHR66200_MINOR_VERSION));
    checkErr( Ivi_SetAttrReadCallbackViString (vi, CHR66200_ATTR_SPECIFIC_DRIVER_REVISION,
                                               chr66200AttrDriverRevision_ReadCallback));
    checkErr( Ivi_SetAttributeViInt32 (vi, "", CHR66200_ATTR_SPECIFIC_DRIVER_CLASS_SPEC_MAJOR_VERSION,
                                       0, CHR66200_CLASS_SPEC_MAJOR_VERSION));
    checkErr( Ivi_SetAttributeViInt32 (vi, "", CHR66200_ATTR_SPECIFIC_DRIVER_CLASS_SPEC_MINOR_VERSION,
                                       0, CHR66200_CLASS_SPEC_MINOR_VERSION));
    checkErr( Ivi_SetAttributeViString (vi, "", CHR66200_ATTR_IO_SESSION_TYPE,
                                        0, CHR66200_IO_SESSION_TYPE));
    checkErr( Ivi_SetAttributeViString (vi, "", CHR66200_ATTR_SUPPORTED_INSTRUMENT_MODELS,
                                        0, CHR66200_SUPPORTED_INSTRUMENT_MODELS));


    checkErr( Ivi_SetAttrReadCallbackViString (vi, CHR66200_ATTR_INSTRUMENT_FIRMWARE_REVISION,
                                               chr66200AttrFirmwareRevision_ReadCallback));

	checkErr( Ivi_GetAttributeFlags (vi, CHR66200_ATTR_INSTRUMENT_MANUFACTURER, &flags));
	checkErr( Ivi_SetAttributeFlags (vi, CHR66200_ATTR_INSTRUMENT_MANUFACTURER,
	                                 flags | IVI_VAL_USE_CALLBACKS_FOR_SIMULATION));
	checkErr( Ivi_SetAttrReadCallbackViString (vi, CHR66200_ATTR_INSTRUMENT_MANUFACTURER,
	                                           chr66200AttrInstrumentManufacturer_ReadCallback));

	checkErr( Ivi_GetAttributeFlags (vi, CHR66200_ATTR_INSTRUMENT_MODEL, &flags));
	checkErr( Ivi_SetAttributeFlags (vi, CHR66200_ATTR_INSTRUMENT_MODEL,
	                                 flags | IVI_VAL_USE_CALLBACKS_FOR_SIMULATION));
	checkErr( Ivi_SetAttrReadCallbackViString (vi, CHR66200_ATTR_INSTRUMENT_MODEL,
	                                           chr66200AttrInstrumentModel_ReadCallback));

    checkErr( Ivi_SetAttributeViString (vi, "", CHR66200_ATTR_SPECIFIC_DRIVER_VENDOR,
                                        0, CHR66200_DRIVER_VENDOR));
    checkErr( Ivi_SetAttributeViString (vi, "", CHR66200_ATTR_SPECIFIC_DRIVER_DESCRIPTION,
                                        0, CHR66200_DRIVER_DESCRIPTION));
    checkErr( Ivi_SetAttributeViAddr (vi, VI_NULL, IVI_ATTR_OPC_CALLBACK, 0,
                                      chr66200_WaitForOPCCallback));
    checkErr( Ivi_SetAttributeViAddr (vi, VI_NULL, IVI_ATTR_CHECK_STATUS_CALLBACK, 0,
                                      chr66200_CheckStatusCallback));
	checkErr( Ivi_SetAttributeViBoolean (vi, VI_NULL, IVI_ATTR_SUPPORTS_WR_BUF_OPER_MODE,
	                                     0, VI_TRUE));



	checkErr( Ivi_SetAttributeViString (vi, "", CHR66200_ATTR_GROUP_CAPABILITIES, 0,
	                                    "None"));

        /*- Add instrument-specific attributes ------------------------------*/

	checkErr( Ivi_AddAttributeViString (vi, CHR66200_ATTR_ID_QUERY_RESPONSE,
	                                    "CHR66200_ATTR_ID_QUERY_RESPONSE",
	                                    "Chroma ATE,66202,0,1.00",
	                                    IVI_VAL_NOT_USER_WRITABLE,
	                                    chr66200AttrIdQueryResponse_ReadCallback,
	                                    VI_NULL));

    checkErr( Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_OPC_TIMEOUT,
                                       "CHR66200_ATTR_OPC_TIMEOUT",
                                       5000, IVI_VAL_HIDDEN | IVI_VAL_DONT_CHECK_STATUS,
                                       VI_NULL, VI_NULL, VI_NULL));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_CURR_SHUNT,
	                                   "CHR66200_ATTR_CURR_SHUNT",
	                                   CHR66200_VAL_SHUNT_LOW, 0,
	                                   chr66200AttrCurrShunt_ReadCallback,
	                                   chr66200AttrCurrShunt_WriteCallback,
	                                   &attrCurrShuntRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_CURR_RANGE,
	                                   "CHR66200_ATTR_CURR_RANGE",
	                                   CHR66200_VAL_CURR_RANGE_AUTO, 0,
	                                   chr66200AttrCurrRange_ReadCallback,
	                                   chr66200AttrCurrRange_WriteCallback,
	                                   &attrCurrRangeRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_INRUSH_LEVEL,
	                                   "CHR66200_ATTR_INRUSH_LEVEL", 1, 0,
	                                   chr66200AttrInrushLevel_ReadCallback,
	                                   chr66200AttrInrushLevel_WriteCallback,
	                                   &attrInrushLevelRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_INRUSH_TIME,
	                                   "CHR66200_ATTR_INRUSH_TIME", 100, 0,
	                                   chr66200AttrInrushTime_ReadCallback,
	                                   chr66200AttrInrushTime_WriteCallback,
	                                   &attrInrushTimeRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_INRUSH_DELAY,
	                                   "CHR66200_ATTR_INRUSH_DELAY", 2, 0,
	                                   chr66200AttrInrushDelay_ReadCallback,
	                                   chr66200AttrInrushDelay_WriteCallback,
	                                   &attrInrushDelayRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_VOLT_RANGE,
	                                   "CHR66200_ATTR_VOLT_RANGE",
	                                   CHR66200_VAL_VOLT_RANGE_AUTO, 0,
	                                   chr66200AttrVoltRange_ReadCallback,
	                                   chr66200AttrVoltRange_WriteCallback,
	                                   &attrVoltRangeRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_AVERAGE,
	                                   "CHR66200_ATTR_AVERAGE", 4, 0,
	                                   chr66200AttrAverage_ReadCallback,
	                                   chr66200AttrAverage_WriteCallback,
	                                   &attrAverageRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_POWER_INTEGRATE,
	                                   "CHR66200_ATTR_POWER_INTEGRATE", 0, 0,
	                                   chr66200AttrPowerIntegrate_ReadCallback,
	                                   chr66200AttrPowerIntegrate_WriteCallback,
	                                   &attrPowerIntegrateRangeTable));
	checkErr (Ivi_AddAttributeViBoolean (vi, CHR66200_ATTR_FILTER,
	                                     "CHR66200_ATTR_FILTER", VI_TRUE, 0,
	                                     chr66200AttrFilter_ReadCallback,
	                                     chr66200AttrFilter_WriteCallback));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_ENERGY_TIME,
	                                   "CHR66200_ATTR_ENERGY_TIME", 0, 0,
	                                   chr66200AttrEnergyTime_ReadCallback,
	                                   chr66200AttrEnergyTime_WriteCallback,
	                                   &attrEnergyTimeRangeTable));
	checkErr (Ivi_AddAttributeViBoolean (vi, CHR66200_ATTR_THD_MODE,
	                                     "CHR66200_ATTR_THD_MODE", VI_TRUE, 0,
	                                     chr66200AttrThdMode_ReadCallback,
	                                     chr66200AttrThdMode_WriteCallback));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_THD_ORDER,
	                                   "CHR66200_ATTR_THD_ORDER", 13, 0,
	                                   chr66200AttrThdOrder_ReadCallback,
	                                   chr66200AttrThdOrder_WriteCallback,
	                                   &attrThdOrderRangeTable));
	checkErr (Ivi_AddAttributeViBoolean (vi, CHR66200_ATTR_COMPARATOR,
	                                     "CHR66200_ATTR_COMPARATOR", VI_FALSE, 0,
	                                     chr66200AttrComparator_ReadCallback,
	                                     chr66200AttrComparator_WriteCallback));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_COMPARATOR_TIME,
	                                   "CHR66200_ATTR_COMPARATOR_TIME", 0, 0,
	                                   chr66200AttrComparatorTime_ReadCallback,
	                                   chr66200AttrComparatorTime_WriteCallback,
	                                   &attrComparatorTimeRangeTable));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_ITEM,
	                                    "CHR66200_ATTR_COMPARATOR_ITEM", "V",
	                                    IVI_VAL_HIDDEN,
	                                    chr66200AttrComparatorItem_ReadCallback,
	                                    chr66200AttrComparatorItem_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_V,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_V", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitV_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_VPK_PLUS,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_VPK_PLUS",
	                                    "0,0", IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitVpkPlus_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_VPK_MINUS,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_VPK_MINUS",
	                                    "0,0", IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitVpkMinus_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_THDV,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_THDV", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitThdv_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_W,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_W", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitW_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_PF,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_PF", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitPf_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_VA,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_VA", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitVa_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_VAR,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_VAR", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitVar_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_ENERGY,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_ENERGY",
	                                    "0,0", IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitEnergy_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_FREQ,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_FREQ", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitFreq_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_I,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_I", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitI_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_IPK_PLUS,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_IPK_PLUS",
	                                    "0,0", IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitIpkPlus_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_IPK_MINUS,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_IPK_MINUS",
	                                    "0,0", IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitIpkMinus_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_IS,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_IS", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitIs_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_CF,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_CF", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitCf_WriteCallback));
	checkErr (Ivi_AddAttributeViString (vi, CHR66200_ATTR_COMPARATOR_LIMIT_THDI,
	                                    "CHR66200_ATTR_COMPARATOR_LIMIT_THDI", "0,0",
	                                    IVI_VAL_HIDDEN, VI_NULL,
	                                    chr66200AttrComparatorLimitThdi_WriteCallback));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_STATUS_ESE,
	                                   "CHR66200_ATTR_STATUS_ESE", 0, 0,
	                                   chr66200AttrStatusEse_ReadCallback,
	                                   chr66200AttrStatusEse_WriteCallback,
	                                   &attrStatusEseRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_STATUS_SRE,
	                                   "CHR66200_ATTR_STATUS_SRE", 0, 0,
	                                   chr66200AttrStatusSre_ReadCallback,
	                                   chr66200AttrStatusSre_WriteCallback,
	                                   &attrStatusSreRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_STATUS_OPERATION_ENABLE,
	                                   "CHR66200_ATTR_STATUS_OPERATION_ENABLE", 0, 0,
	                                   chr66200AttrStatusOperationEnable_ReadCallback,
	                                   chr66200AttrStatusOperationEnable_WriteCallback,
	                                   &attrStatusOperationEnableRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_STATUS_QUESTIONABLE_ENABLE,
	                                   "CHR66200_ATTR_STATUS_QUESTIONABLE_ENABLE", 0,
	                                   0,
	                                   chr66200AttrStatusQuestionableEnable_ReadCallback,
	                                   chr66200AttrStatusQuestionableEnable_WriteCallback,
	                                   &attrStatusQuestionableEnableRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_STATUS_QUESTIONABLE_NTR,
	                                   "CHR66200_ATTR_STATUS_QUESTIONABLE_NTR", 0, 0,
	                                   chr66200AttrStatusQuestionableNtr_ReadCallback,
	                                   chr66200AttrStatusQuestionableNtr_WriteCallback,
	                                   &attrStatusQuestionableNtrRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_STATUS_QUESTIONABLE_PTR,
	                                   "CHR66200_ATTR_STATUS_QUESTIONABLE_PTR", 0, 0,
	                                   chr66200AttrStatusQuestionablePtr_ReadCallback,
	                                   chr66200AttrStatusQuestionablePtr_WriteCallback,
	                                   &attrStatusQuestionablePtrRangeTable));
	checkErr (Ivi_AddAttributeViBoolean (vi, CHR66200_ATTR_ENERGY_MODE,
	                                     "CHR66200_ATTR_ENERGY_MODE", VI_TRUE, 0,
	                                     chr66200AttrEnergyMode_ReadCallback,
	                                     chr66200AttrEnergyMode_WriteCallback));
	checkErr (Ivi_AddAttributeViInt32 (vi, CHR66200_ATTR_TRIGGER_MODE,
	                                   "CHR66200_ATTR_TRIGGER_MODE",
	                                   CHR66200_VAL_TRIGGER_NONE, 0,
	                                   chr66200AttrTriggerMode_ReadCallback,
	                                   chr66200AttrTriggerMode_WriteCallback,
	                                   &attrTriggerModeRangeTable));
	checkErr (Ivi_AddAttributeViBoolean (vi, CHR66200_ATTR_MEAS_MODE,
	                                     "CHR66200_ATTR_MEAS_MODE", VI_TRUE, 0,
	                                     chr66200AttrMeasMode_ReadCallback,
	                                     chr66200AttrMeasMode_WriteCallback));
	checkErr (Ivi_AddAttributeViReal64 (vi, CHR66200_ATTR_WINDOW,
	                                    "CHR66200_ATTR_WINDOW", 4, 0,
	                                    chr66200AttrWindow_ReadCallback,
	                                    chr66200AttrWindow_WriteCallback,
	                                    &attrWindowRangeTable, 0));

        /*- Setup attribute invalidations -----------------------------------*/


	checkErr (Ivi_AddAttributeInvalidation (vi, CHR66200_ATTR_CURR_SHUNT,
	                                        CHR66200_ATTR_CURR_RANGE, VI_FALSE));
	checkErr (Ivi_AddAttributeInvalidation (vi, CHR66200_ATTR_CURR_SHUNT,
	                                        CHR66200_ATTR_COMPARATOR_LIMIT_I,
	                                        VI_FALSE));
	checkErr (Ivi_AddAttributeInvalidation (vi, CHR66200_ATTR_CURR_SHUNT,
	                                        CHR66200_ATTR_COMPARATOR_LIMIT_IPK_PLUS,
	                                        VI_FALSE));
	checkErr (Ivi_AddAttributeInvalidation (vi, CHR66200_ATTR_CURR_SHUNT,
	                                        CHR66200_ATTR_COMPARATOR_LIMIT_IPK_MINUS,
	                                        VI_FALSE));
	checkErr (Ivi_AddAttributeInvalidation (vi, CHR66200_ATTR_CURR_SHUNT,
	                                        CHR66200_ATTR_COMPARATOR_LIMIT_IS,
	                                        VI_FALSE));
Error:
    return error;
}

/*****************************************************************************
 *------------------- End Instrument Driver Source Code ---------------------*
 *****************************************************************************/
