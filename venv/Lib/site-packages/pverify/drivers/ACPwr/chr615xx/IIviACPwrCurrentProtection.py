# ===========================================================================
# Copyright (C) 2012-2013 Infineon Technologies AG
# All rights reserved.
# ===========================================================================
#
# ===========================================================================
# This document contains proprietary information of Infineon Technologies AG.
# Passing on and copying of this document, and communication of its contents
# is not permitted without Infineon's prior written authorisation.
# ===========================================================================
#
# -------------------------------------------------------------------------------
# Revision       : $Rev$
# Date           : $Date$
# Last change by : $Author$
# -------------------------------------------------------------------------------
"""
Module docstring
"""

from __future__ import annotations

from . import IIviACPwrBase


class IIviACPwrCurrentProtection(IIviACPwrBase.IIviACPwrBase):
    """IVI ACPwr class-compliant Current Protection interface.

    NOTE:
        Attributes/Methods marked with '#' do not exist for this instrument.
        Attributes/Methods marked with '*' are specific for this instrument.
        !Please consider when trying to program instrument independent.

    Attributes:
        Delay [float]
            Specifies the time the output current must exceed the current
            protection threshold until current protection trips.

        #Enabled [boolean]
            When set to True, current protection trips when the output current exceeds
            the current protection threshold for the time specified by the
            current protection delay. When set to False, current protection is disabled.

        #Threshold [float]
            Specifies the output current threshold that trips current protection.

        #Tripped [boolean]
            Indicates if current protection has tripped.


    Methods:
        Configure (Enabled, Threshold, Delay):
            Configures the Current Proteciton Enabled, Current Protection
            Delay and Current Protection Threshold properties.

        Reset
            Resets the current protection state of the power source after
            current protection has tripped.

    """

    def __init__(self, interface):
        IIviACPwrBase.IIviACPwrBase.__init__(self, interface)

    # Read only dependent properties
    @property
    def Tripped(self):
        """
        Indicates if current protection has tripped.
        """
        raise NotImplementedError

    # Read-write dependent properties
    @property
    def Delay(self):
        """
        Specifies the time the output current must exceed the current
        protection threshold until current protection trips.

        :return: float
        """

        answ = self.interface.vi_query(":CURR:DEL?", "%s\n", "%f")
        self.GetError()
        return answ

    @Delay.setter
    def Delay(self, value):
        """
        Specifies the time the output current must exceed the current
        protection threshold until current protection trips.

        :type value: float
        """
        self.interface.vi_write(f":CURR:DEL {value:f}")
        self.GetError()

    @property
    def Enabled(self):
        """
        When set to True, current protection trips when the output current
        exceeds the current protection threshold for the time specified by the
        current protection delay. When set to False, current protection is
        disabled.
        """
        return True

    @Enabled.setter
    def Enabled(self, value):
        """
        When set to True, current protection trips when the output current
        exceeds the current protection threshold for the time specified by the
        current protection delay. When set to False, current protection is
        disabled.
        """
        if not bool(value):
            msg = "Current protection cannot be disabled for this instrument!"
            raise Exception(msg)

    @property
    def Threshold(self):
        """
        Specifies the output current threshold that trips current protection.
        """
        answ = self.interface.vi_query(":CURR:LIM?", "%s\n", "%f")
        self.GetError()
        return answ

    @Threshold.setter
    def Threshold(self, value):
        """
        Specifies the output current threshold that trips current protection.
        """
        self.interface.vi_write(f":CURR:LIM {value:.2f}")
        self.GetError()

    # Methods
    def Configure(self, Enabled, Threshold, Delay):
        """
        Configures the Current Protection Enabled, Current Protection Delay
        and Current Protection Threshold properties.

        :param Enabled:
            Sets the Current Protection Enabled property.
        :type Enabled: bool

        :param Threshold:
            Sets the Current Protection Threshold property.
        :type Threshold: float

        :param Delay:
            Sets the Current Protection Delay property.
        :type Delay: float

        """

        # self.Enabled = Enabled
        self.Threshold = Threshold
        self.Delay = Delay
        return

    def Reset(self):
        """
        Resets the current protection state of the power source after current
        protection has tripped.
        """
        self.interface.vi_write(":OUTP:PROT:CLE")
        self.GetError()
