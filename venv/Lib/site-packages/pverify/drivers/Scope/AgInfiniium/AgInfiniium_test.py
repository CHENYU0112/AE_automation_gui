from __future__ import annotations

from pverify.core.lab.ivi.headers.ivi import IVI_ATTR_INSTRUMENT_MANUFACTURER
from pverify.drivers.Scope.AgInfiniium import IIviScope
from pverify.drivers.SimplifiedLabInstruments import SimpleScope

scope = SimpleScope(IIviScope())
scope.Initialize("GPIB0::1::INSTR", True, False, OptionString="simulate=true")

#############################
#  Low-Level Demonstration  #
######################################################################################################
#  For High-Level usage of the SimpleScope class please check the documentation at:                  #
#  http://goto/inicio_doc/latest/docs/pVerify_Documentation/html/InstrumentDrivers.html#simplescope  #
######################################################################################################

vi = scope._lowlevel_driver.vi
scope._lowlevel_driver: IIviScope  # noqa: B032

scope._lowlevel_driver.dllwrap.SystemWriteString(vi, "*IDN?")
readback = scope._lowlevel_driver.dllwrap.SystemReadString(vi, 1024)
print(f"Readback of '*IDN?' (does not work in simulation mode): '{readback}'")

readback = scope._lowlevel_driver.dllwrap.GetAttributeViString(vi, None, IVI_ATTR_INSTRUMENT_MANUFACTURER, 1024)
print(f"Readback of GetAttributeViString querying the Instrument Manufacturer: '{readback}'")

scope.Close()
