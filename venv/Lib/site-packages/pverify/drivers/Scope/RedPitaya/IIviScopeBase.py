# -------------------------------------------------------------------------------
# Name           :
# Description    :
#
# Revision       : $Rev$
# Date           : $Date$
# Last change by : $Author$
# -------------------------------------------------------------------------------
from __future__ import annotations

from pverify.drivers.BaseInstrument import InstrumentError
from pverify.drivers.Scope.RedPitaya import IIviScopeEnums


class IIviScopeBase:
    """Common methods/properties for all interfaces.

    Attributes:
        Enums
            NOT AVAILABLE IN OFFICIAL IVI DRIVERS
            Contains python dictionaries that contain the enumerations

        interface
            NOT AVAILABLE IN OFFICIAL IVI DRIVERS
            Specific for instrument connection via VISA.
            Provides interface for wrapped VISA library.
    """

    def __init__(self, interface):
        self.Enums = IIviScopeEnums
        self.interface = interface
        if False:
            from pverify.drivers.BaseInstrument import BaseVisaInstrument

            self.interface = BaseVisaInstrument()

    def GetError(self):
        """Queries all error messages of the scopes error buffer and
        raises an error if one or more errors occurred.
        Additionally occurred error are logged.

        :raise: InstrumentError
        """
        errorList = []
        error = 1
        while error:
            ret = self.interface.vi_query(":SYST:ERR?").strip().split(",")
            error = 1 if int(ret[0]) else 0
            if error:
                errMsg = "ErrCode:%d, ErrMsg:'%s'" % (int(ret[0]), str(ret[1]).strip())
                errorList.append(errMsg)
                self.interface._Log.error(errMsg)
        if errorList:
            raise InstrumentError(str(errorList))
