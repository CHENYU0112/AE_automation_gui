from __future__ import annotations

from .ke2400_const import *
from .ke2400_Measure_X import ke2400_Measure_C, ke2400_Measure_V
from .ke2400_Trace import ke2400_Trace


class ke2400_Measure:
    def __init__(self, parent):
        self._parent = parent
        """:type : pverify.drivers.SMU.ke2400.ke2400_Channel.ke2400_Channel"""
        self._name = self._parent._name

        self.__Voltage = ke2400_Measure_V(self)
        self.__Current = ke2400_Measure_C(self)

        self.__Trace = ke2400_Trace(self)

    @property
    def _root(self):
        return self._parent._parent

    @property
    def _inst(self):
        """
        The instrument visa resource
        """
        return self._root._inst

    @property
    def Voltage(self):
        """
        If the measure mode is set to voltage, use this property to access the voltage measurement subclass
        """
        return self.__Voltage

    @property
    def Current(self):
        """
        If the measure mode is set to current, use this property to access the current measurement subclass
        """
        return self.__Current

    @property
    def Trace(self):
        """
        Use this property to access the subclass for interacting with multi-point traces
        """
        return self.__Trace

    def AutoZeroOnce(self):
        """
        Do a once time refresh of the reference and zero measurements
        """
        self._parent._parent._inst.write("SYST:AZER:STAT ONCE")

    def ConfigureMeasurementCount(self, count):
        """
        not used - kept for compliance with ke2450
        """
        raise NotImplementedError

    def Fetch(self, BufferElements="", BufferName="defbuffer1"):
        """
        Requests the latest post-processed readings stored in the sample buffer based on selected BufferElement.

        Example:
            <instance>.Fetch("defbuffer1", "READ, SOUR")

        :param BufferElements: Specify the buffer elements. If nothing is defined, the source and measurement values are returned as list.

            | After comma delimeter give single space then give another BufferElement.

            READing:
                The measurement reading ; if no buffer elements are defined, this option is used

            SOURce:
                The source value; if readback is ON, then it is the readback value, otherwise it is the programmed source value.

            SOURUNIT:
                The unit of value associated with the source value

            RELative:
                The relative time when the data point was measured

            UNIT:
                The unit of measure associated with the measurement
        :type BufferElements: str
        :param BufferName: not used - kept for compliance with ke2450
        :return: Returns a list of all requested buffer elements. Elements that can be converted to float are converted, other are returned as string.
        :rtype: list[str|float]

        """
        return self._root.LowLevel.Ke24xx_Fetch(BufferElements, measure_fct=self._parent._measure_fct)

    def Read(self, BufferElements="", BufferName="defbuffer1"):
        """
        Query makes measurements, places them in a reading buffer, and returns the latest reading.

        Example:
            <instance>.Read("defbuffer1", "READ, SOUR")


        :param BufferElements: Specify the buffer elements. If nothing is defined, the source and measurement values are returned as list.

            | After comma delimeter give single space then give another BufferElement.

            READing:
                The measurement reading

            SOURce:
                The source value; if readback is ON, then it is the readback value, otherwise it is the programmed source value.

            SOURUNIT:
                The unit of value associated with the source value

            RELative:
                The relative time when the data point was measured

            UNIT:
                The unit of measure associated with the measurement

        :type BufferElements: str
        :param BufferName: not used - kept for compliance with ke2450
        :return: Returns a list of all requested buffer elements. Elements that can be converted to float are converted, other are returned as string.
        :rtype: list[str|float]

        """
        return self._root.LowLevel.Ke24xx_Read(BufferElements, measure_fct=self._parent._measure_fct)
