from __future__ import annotations

import ctypes

from pverify.core.lab.ivi.helper import WinDLL

# load BTS256 Dll
DLLIMPORT = WinDLL("GOMDBTS256.dll")

# setPassword
setPassword = DLLIMPORT["GOMDBTS256_setPassword"]
setPassword.restype = ctypes.c_int
setPassword.argtype = ctypes.c_char_p

# getHandle
getHandle = DLLIMPORT["GOMDBTS256_getHandle"]
getHandle.restype = ctypes.c_int
getHandle.argtypes = (ctypes.c_char_p, ctypes.POINTER(ctypes.c_int))

# releaseHandle
releaseHandle = DLLIMPORT["GOMDBTS256_releaseHandle"]
releaseHandle.restype = ctypes.c_int
releaseHandle.argtype = ctypes.c_int

# actual program
setPassword(b"****")

# search for connected device
handle = ctypes.c_int(0)
rc = getHandle(b"BTS256_0", ctypes.byref(handle))
if rc == 0:
    # do something
    releaseHandle(handle)
