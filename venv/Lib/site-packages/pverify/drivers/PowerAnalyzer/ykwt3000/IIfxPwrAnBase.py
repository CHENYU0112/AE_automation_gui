# ===========================================================================
# ===========================================================================
# Copyright (C) 2012-2013 Infineon Technologies AG
# All rights reserved.
# ===========================================================================
#
# ===========================================================================
# This document contains proprietary information of Infineon Technologies AG.
# Passing on and copying of this document, and communication of its contents
# is not permitted without Infineon's prior written authorisation.
# ===========================================================================
#
# -------------------------------------------------------------------------------
# Revision       : $Rev$
# Date           : $Date$
# Last change by : $Author$
# -------------------------------------------------------------------------------
"""
Module docstring
"""

from __future__ import annotations

from pverify.drivers.BaseInstrument import InstrumentError
from pverify.drivers.PowerAnalyzer.ykwt3000 import IIfxPwrAnEnums


class IIfxPwrAnBase:
    """Common methods/properties for all interfaces"""

    def __init__(self, parent):
        self.Enums = IIfxPwrAnEnums
        self.parent = parent
        self.interface = parent.interface
        self._measuringMode = {
            1: self.Enums.IfxPwrAnMeasuringModeEnum.IfxPwrAnMeasuringModeRMS,
            2: self.Enums.IfxPwrAnMeasuringModeEnum.IfxPwrAnMeasuringModeRMS,
            3: self.Enums.IfxPwrAnMeasuringModeEnum.IfxPwrAnMeasuringModeRMS,
            4: self.Enums.IfxPwrAnMeasuringModeEnum.IfxPwrAnMeasuringModeRMS,
        }

    def GetError(self):
        """Return True if one or more errors occurred, False otherwise.
        Additionally occurred error are logged.

        :raise: InstrumentError
        """
        errorList = []
        error = 1
        while error:
            ret = self.interface.vi_query(":STAT:ERR?").strip().split(",")
            error = 1 if int(ret[0]) else 0
            if error:
                errMsg = "ErrCode:%d, ErrMsg:'%s'" % (int(ret[0]), str(ret[1]).strip())
                errorList.append(errMsg)
                self.interface._Log.error(errMsg)
        if errorList:
            raise InstrumentError(str(errorList))
