from __future__ import annotations

from typing import TYPE_CHECKING

from pverify.core.io.converters.dlh5_to_junitxml import dlh5_to_junitxml
from pverify.core.io.result_storage.result_handler import ConversionHandler

if TYPE_CHECKING:
    from pathlib import Path


class junit_xml_handler(ConversionHandler):
    """
    Creates a json-based result file
    """

    def __init__(self, **kwargs):
        super().__init__(enabled_for=["dlh5_handler"])
        self.filename = ""
        self.indent = 2
        self.incl_parameter_info = True

    def initialize(self):
        self.filename = self.config.get("filename", self.filename)
        self.indent = self.config.get("indent", self.indent)
        self.incl_parameter_info = bool(self.config.get("incl_parameter_info", self.incl_parameter_info))

    def convert(self, file: Path):
        if self.filename == "":
            self.filename = file.stem

        dlh5_to_junitxml(
            filepath_in=file,
            filepath_out=self.resultdir / f"{self.filename}.xml",
            incl_parameter_info=self.incl_parameter_info,
        )
