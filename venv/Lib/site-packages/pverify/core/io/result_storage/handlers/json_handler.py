from __future__ import annotations

from typing import TYPE_CHECKING

from pverify.core.io.converters.dlh5_to_json import dlh5_to_json
from pverify.core.io.result_storage.result_handler import ConversionHandler

if TYPE_CHECKING:
    from pathlib import Path


class json_handler(ConversionHandler):
    """
    Creates a json-based result file
    """

    def __init__(self, **kwargs):
        super().__init__(enabled_for=["dlh5_handler"])
        self.filename = ""
        self.indent = 2

    def initialize(self):
        self.filename = self.config.get("filename", self.filename)
        self.indent = self.config.get("indent", self.indent)

    def convert(self, file: Path):
        if self.filename == "":
            self.filename = file.stem

        dlh5_to_json(filepath_in=file, filepath_out=self.resultdir / f"{self.filename}.json", indent=self.indent)
