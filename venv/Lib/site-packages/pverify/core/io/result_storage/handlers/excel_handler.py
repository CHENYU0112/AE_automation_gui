from __future__ import annotations

from typing import TYPE_CHECKING

from pverify.core.io.converters.dlh5_to_excel import dlh5_to_excel
from pverify.core.io.result_storage.result_handler import ConversionHandler

if TYPE_CHECKING:
    from pathlib import Path


class excel_handler(ConversionHandler):
    """
    Creates a excel-based result file
    """

    def __init__(self, **kwargs):
        super().__init__(enabled_for=["dlh5_handler"])
        self.filename = ""

    def initialize(self):
        self.filename = self.config.get("filename", self.filename)

    def convert(self, file: Path):
        if self.filename == "":
            self.filename = file.stem

        dlh5_to_excel(filepath_in=file, filepath_out=self.resultdir / f"{self.filename}.xlsx")
